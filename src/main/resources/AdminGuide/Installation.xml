<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>AdminGuide</web>
  <name>Installation</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>AdminGuide.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1195482756000</creationDate>
  <date>1360950265000</date>
  <contentUpdateDate>1360950265000</contentUpdateDate>
  <version>1.1</version>
  <title>Installation</title>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.0</syntaxId>
  <hidden>false</hidden>
  <attachment>
    <filename>xwiki.js</filename>
    <filesize>1246</filesize>
    <author>XWiki.bitman09</author>
    <date>1241516154000</date>
    <version>1.4</version>
    <comment/>
    <content>QWpheC5YV2lraVJlcXVlc3QgPSBDbGFzcy5jcmVhdGUoKTsKCk9iamVjdC5leHRlbmQoT2JqZWN0
LmV4dGVuZChBamF4LlhXaWtpUmVxdWVzdC5wcm90b3R5cGUsIEFqYXguUmVxdWVzdC5wcm90b3R5
cGUpLCB7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oc3BhY2UsIGRvY05hbWUsIG9wdGlvbnMpIHsK
CiAgICB0aGlzLnRyYW5zcG9ydCA9IEFqYXguZ2V0VHJhbnNwb3J0KCk7CiAgICB0aGlzLnNldE9w
dGlvbnMob3B0aW9ucyk7CiAgICB0aGlzLmJhc2VVcmwgPSAiL3h3aWtpL2Jpbi92aWV3IjsKCiAg
ICB2YXIgb25Db21wbGV0ZSA9IHRoaXMub3B0aW9ucy5vbkNvbXBsZXRlIHx8IFByb3RvdHlwZS5l
bXB0eUZ1bmN0aW9uOwogICAgdGhpcy5vcHRpb25zLm9uQ29tcGxldGUgPSAoZnVuY3Rpb24oKSB7
CiAgICAgIHRoaXMucmV0dXJuVmFsdWUob25Db21wbGV0ZSk7CiAgICAgIC8vb25Db21wbGV0ZSh0
aGlzLnRyYW5zcG9ydCk7CiAgICB9KS5iaW5kKHRoaXMpOwoKICAgIHRoaXMucmVxdWVzdCh0aGlz
LmdlbmVyYXRlVXJsKHNwYWNlLCBkb2NOYW1lKSk7CiAgfSwKCiAgICBnZW5lcmF0ZVVybDogZnVu
Y3Rpb24oc3BhY2UsIGRvY05hbWUpewogICAgICAgIHJldHVybiB0aGlzLmJhc2VVcmwgKyAiLyIg
KyBzcGFjZSArICIvIiArIGRvY05hbWU7CiAgfSwKCiAgcmV0dXJuVmFsdWU6IGZ1bmN0aW9uKGNh
bGxCYWNrKSB7CgogICAgaWYgKGNhbGxCYWNrKQogICAgICAgIGNhbGxCYWNrKHRoaXMudHJhbnNw
b3J0KTsKICAgIGVsc2UKICAgICAgICBhbGVydCgiZXJyb3IsIGNhbGxiYWNrIik7CiAgfQp9KTsK
CgoKdmFyIFhXaWtpID0gQ2xhc3MuY3JlYXRlKCk7CgpYV2lraS5wcm90b3R5cGUgPSB7CiAgICAg
ICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24od2lraVVybCl7dGhpcy53aWtpVXJsID0gd2lraVVybDt9
LAogICAgICAgIGdldFNwYWNlczogZnVuY3Rpb24oY2FsbEJhY2spewogICAgICAgICAgICB2YXIg
cGFyYW1zID0gJyc7CiAgICAgICAgICAgIHZhciBteUFqYXggPSBuZXcgQWpheC5YV2lraVJlcXVl
c3QoICJBamF4IiwgImdldFNwYWNlcyIsIHttZXRob2Q6ICdnZXQnLCBwYXJhbWV0ZXJzOiBwYXJh
bXMsIG9uQ29tcGxldGU6IGdldFNwYWNlc0NhbGxCYWNrfSApOwogICAgICAgIH0sCgogICAgICAg
IGdldFNwYWNlc0NhbGxCYWNrOiBmdW5jdGlvbihhamF4UmVzcG9uc2UpewogICAgICAgICAgICB2
YXIgeG1sID0gYWpheFJlc3BvbnNlLnJlc3BvbnNlWE1MOwoKICAgICAgICB9Cn0KCg==
</content>
  </attachment>
  <attachment>
    <filename>prototype.js</filename>
    <filesize>49276</filesize>
    <author>XWiki.bitman09</author>
    <date>1241516154000</date>
    <version>1.4</version>
    <comment/>
    <content>LyogIFByb3RvdHlwZSBKYXZhU2NyaXB0IGZyYW1ld29yaywgdmVyc2lvbiAxLjQuMA0KICogIChj
KSAyMDA1IFNhbSBTdGVwaGVuc29uIDxzYW1AY29uaW8ubmV0Pg0KICoNCiAqICBQcm90b3R5cGUg
aXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIGFuIE1JVC1zdHlsZSBs
aWNlbnNlLg0KICogIEZvciBkZXRhaWxzLCBzZWUgdGhlIFByb3RvdHlwZSB3ZWIgc2l0ZTogaHR0
cDovL3Byb3RvdHlwZS5jb25pby5uZXQvDQogKg0KLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCnZh
ciBQcm90b3R5cGUgPSB7DQogIFZlcnNpb246ICcxLjQuMCcsDQogIFNjcmlwdEZyYWdtZW50OiAn
KD86PHNjcmlwdC4qPz4pKChcbnxccnwuKSo/KSg/OjxcL3NjcmlwdD4pJywNCg0KICBlbXB0eUZ1
bmN0aW9uOiBmdW5jdGlvbigpIHt9LA0KICBLOiBmdW5jdGlvbih4KSB7cmV0dXJuIHh9DQp9DQoN
CnZhciBDbGFzcyA9IHsNCiAgY3JlYXRlOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gZnVuY3Rp
b24oKSB7DQogICAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAg
ICB9DQogIH0NCn0NCg0KdmFyIEFic3RyYWN0ID0gbmV3IE9iamVjdCgpOw0KDQpPYmplY3QuZXh0
ZW5kID0gZnVuY3Rpb24oZGVzdGluYXRpb24sIHNvdXJjZSkgew0KICBmb3IgKHByb3BlcnR5IGlu
IHNvdXJjZSkgew0KICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07
DQogIH0NCiAgcmV0dXJuIGRlc3RpbmF0aW9uOw0KfQ0KDQpPYmplY3QuaW5zcGVjdCA9IGZ1bmN0
aW9uKG9iamVjdCkgew0KICB0cnkgew0KICAgIGlmIChvYmplY3QgPT0gdW5kZWZpbmVkKSByZXR1
cm4gJ3VuZGVmaW5lZCc7DQogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gJ251bGwnOw0K
ICAgIHJldHVybiBvYmplY3QuaW5zcGVjdCA/IG9iamVjdC5pbnNwZWN0KCkgOiBvYmplY3QudG9T
dHJpbmcoKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIGlmIChlIGluc3RhbmNlb2YgUmFuZ2VFcnJv
cikgcmV0dXJuICcuLi4nOw0KICAgIHRocm93IGU7DQogIH0NCn0NCg0KRnVuY3Rpb24ucHJvdG90
eXBlLmJpbmQgPSBmdW5jdGlvbigpIHsNCiAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9ICRB
KGFyZ3VtZW50cyksIG9iamVjdCA9IGFyZ3Muc2hpZnQoKTsNCiAgcmV0dXJuIGZ1bmN0aW9uKCkg
ew0KICAgIHJldHVybiBfX21ldGhvZC5hcHBseShvYmplY3QsIGFyZ3MuY29uY2F0KCRBKGFyZ3Vt
ZW50cykpKTsNCiAgfQ0KfQ0KDQpGdW5jdGlvbi5wcm90b3R5cGUuYmluZEFzRXZlbnRMaXN0ZW5l
ciA9IGZ1bmN0aW9uKG9iamVjdCkgew0KICB2YXIgX19tZXRob2QgPSB0aGlzOw0KICByZXR1cm4g
ZnVuY3Rpb24oZXZlbnQpIHsNCiAgICByZXR1cm4gX19tZXRob2QuY2FsbChvYmplY3QsIGV2ZW50
IHx8IHdpbmRvdy5ldmVudCk7DQogIH0NCn0NCg0KT2JqZWN0LmV4dGVuZChOdW1iZXIucHJvdG90
eXBlLCB7DQogIHRvQ29sb3JQYXJ0OiBmdW5jdGlvbigpIHsNCiAgICB2YXIgZGlnaXRzID0gdGhp
cy50b1N0cmluZygxNik7DQogICAgaWYgKHRoaXMgPCAxNikgcmV0dXJuICcwJyArIGRpZ2l0czsN
CiAgICByZXR1cm4gZGlnaXRzOw0KICB9LA0KDQogIHN1Y2M6IGZ1bmN0aW9uKCkgew0KICAgIHJl
dHVybiB0aGlzICsgMTsNCiAgfSwNCg0KICB0aW1lczogZnVuY3Rpb24oaXRlcmF0b3IpIHsNCiAg
ICAkUigwLCB0aGlzLCB0cnVlKS5lYWNoKGl0ZXJhdG9yKTsNCiAgICByZXR1cm4gdGhpczsNCiAg
fQ0KfSk7DQoNCnZhciBUcnkgPSB7DQogIHRoZXNlOiBmdW5jdGlvbigpIHsNCiAgICB2YXIgcmV0
dXJuVmFsdWU7DQoNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkr
Kykgew0KICAgICAgdmFyIGxhbWJkYSA9IGFyZ3VtZW50c1tpXTsNCiAgICAgIHRyeSB7DQogICAg
ICAgIHJldHVyblZhbHVlID0gbGFtYmRhKCk7DQogICAgICAgIGJyZWFrOw0KICAgICAgfSBjYXRj
aCAoZSkge30NCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuVmFsdWU7DQogIH0NCn0NCg0KLyot
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLSovDQoNCnZhciBQZXJpb2RpY2FsRXhlY3V0ZXIgPSBDbGFzcy5jcmVh
dGUoKTsNClBlcmlvZGljYWxFeGVjdXRlci5wcm90b3R5cGUgPSB7DQogIGluaXRpYWxpemU6IGZ1
bmN0aW9uKGNhbGxiYWNrLCBmcmVxdWVuY3kpIHsNCiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJh
Y2s7DQogICAgdGhpcy5mcmVxdWVuY3kgPSBmcmVxdWVuY3k7DQogICAgdGhpcy5jdXJyZW50bHlF
eGVjdXRpbmcgPSBmYWxzZTsNCg0KICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjaygpOw0KICB9LA0K
DQogIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgew0KICAgIHNldEludGVydmFsKHRoaXMu
b25UaW1lckV2ZW50LmJpbmQodGhpcyksIHRoaXMuZnJlcXVlbmN5ICogMTAwMCk7DQogIH0sDQoN
CiAgb25UaW1lckV2ZW50OiBmdW5jdGlvbigpIHsNCiAgICBpZiAoIXRoaXMuY3VycmVudGx5RXhl
Y3V0aW5nKSB7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmN1cnJlbnRseUV4ZWN1dGluZyA9
IHRydWU7DQogICAgICAgIHRoaXMuY2FsbGJhY2soKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAg
ICAgIHRoaXMuY3VycmVudGx5RXhlY3V0aW5nID0gZmFsc2U7DQogICAgICB9DQogICAgfQ0KICB9
DQp9DQoNCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpmdW5jdGlvbiAkKCkgew0KICB2YXIgZWxl
bWVudHMgPSBuZXcgQXJyYXkoKTsNCg0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5s
ZW5ndGg7IGkrKykgew0KICAgIHZhciBlbGVtZW50ID0gYXJndW1lbnRzW2ldOw0KICAgIGlmICh0
eXBlb2YgZWxlbWVudCA9PSAnc3RyaW5nJykNCiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRF
bGVtZW50QnlJZChlbGVtZW50KTsNCg0KICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpDQog
ICAgICByZXR1cm4gZWxlbWVudDsNCg0KICAgIGVsZW1lbnRzLnB1c2goZWxlbWVudCk7DQogIH0N
Cg0KICByZXR1cm4gZWxlbWVudHM7DQp9DQpPYmplY3QuZXh0ZW5kKFN0cmluZy5wcm90b3R5cGUs
IHsNCiAgc3RyaXBUYWdzOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC88
XC8/W14+XSs+L2dpLCAnJyk7DQogIH0sDQoNCiAgc3RyaXBTY3JpcHRzOiBmdW5jdGlvbigpIHsN
CiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdt
ZW50LCAnaW1nJyksICcnKTsNCiAgfSwNCg0KICBleHRyYWN0U2NyaXB0czogZnVuY3Rpb24oKSB7
DQogICAgdmFyIG1hdGNoQWxsID0gbmV3IFJlZ0V4cChQcm90b3R5cGUuU2NyaXB0RnJhZ21lbnQs
ICdpbWcnKTsNCiAgICB2YXIgbWF0Y2hPbmUgPSBuZXcgUmVnRXhwKFByb3RvdHlwZS5TY3JpcHRG
cmFnbWVudCwgJ2ltJyk7DQogICAgcmV0dXJuICh0aGlzLm1hdGNoKG1hdGNoQWxsKSB8fCBbXSku
bWFwKGZ1bmN0aW9uKHNjcmlwdFRhZykgew0KICAgICAgcmV0dXJuIChzY3JpcHRUYWcubWF0Y2go
bWF0Y2hPbmUpIHx8IFsnJywgJyddKVsxXTsNCiAgICB9KTsNCiAgfSwNCg0KICBldmFsU2NyaXB0
czogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMuZXh0cmFjdFNjcmlwdHMoKS5tYXAoZXZh
bCk7DQogIH0sDQoNCiAgZXNjYXBlSFRNTDogZnVuY3Rpb24oKSB7DQogICAgdmFyIGRpdiA9IGRv
Y3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3Jl
YXRlVGV4dE5vZGUodGhpcyk7DQogICAgZGl2LmFwcGVuZENoaWxkKHRleHQpOw0KICAgIHJldHVy
biBkaXYuaW5uZXJIVE1MOw0KICB9LA0KDQogIHVuZXNjYXBlSFRNTDogZnVuY3Rpb24oKSB7DQog
ICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIGRpdi5pbm5l
ckhUTUwgPSB0aGlzLnN0cmlwVGFncygpOw0KICAgIHJldHVybiBkaXYuY2hpbGROb2Rlc1swXSA/
IGRpdi5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA6ICcnOw0KICB9LA0KDQogIHRvUXVlcnlQYXJh
bXM6IGZ1bmN0aW9uKCkgew0KICAgIHZhciBwYWlycyA9IHRoaXMubWF0Y2goL15cPz8oLiopJC8p
WzFdLnNwbGl0KCcmJyk7DQogICAgcmV0dXJuIHBhaXJzLmluamVjdCh7fSwgZnVuY3Rpb24ocGFy
YW1zLCBwYWlyU3RyaW5nKSB7DQogICAgICB2YXIgcGFpciA9IHBhaXJTdHJpbmcuc3BsaXQoJz0n
KTsNCiAgICAgIHBhcmFtc1twYWlyWzBdXSA9IHBhaXJbMV07DQogICAgICByZXR1cm4gcGFyYW1z
Ow0KICAgIH0pOw0KICB9LA0KDQogIHRvQXJyYXk6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB0
aGlzLnNwbGl0KCcnKTsNCiAgfSwNCg0KICBjYW1lbGl6ZTogZnVuY3Rpb24oKSB7DQogICAgdmFy
IG9TdHJpbmdMaXN0ID0gdGhpcy5zcGxpdCgnLScpOw0KICAgIGlmIChvU3RyaW5nTGlzdC5sZW5n
dGggPT0gMSkgcmV0dXJuIG9TdHJpbmdMaXN0WzBdOw0KDQogICAgdmFyIGNhbWVsaXplZFN0cmlu
ZyA9IHRoaXMuaW5kZXhPZignLScpID09IDANCiAgICAgID8gb1N0cmluZ0xpc3RbMF0uY2hhckF0
KDApLnRvVXBwZXJDYXNlKCkgKyBvU3RyaW5nTGlzdFswXS5zdWJzdHJpbmcoMSkNCiAgICAgIDog
b1N0cmluZ0xpc3RbMF07DQoNCiAgICBmb3IgKHZhciBpID0gMSwgbGVuID0gb1N0cmluZ0xpc3Qu
bGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgIHZhciBzID0gb1N0cmluZ0xpc3RbaV07DQog
ICAgICBjYW1lbGl6ZWRTdHJpbmcgKz0gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vi
c3RyaW5nKDEpOw0KICAgIH0NCg0KICAgIHJldHVybiBjYW1lbGl6ZWRTdHJpbmc7DQogIH0sDQoN
CiAgaW5zcGVjdDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuICInIiArIHRoaXMucmVwbGFjZSgn
XFwnLCAnXFxcXCcpLnJlcGxhY2UoIiciLCAnXFxcJycpICsgIiciOw0KICB9DQp9KTsNCg0KU3Ry
aW5nLnByb3RvdHlwZS5wYXJzZVF1ZXJ5ID0gU3RyaW5nLnByb3RvdHlwZS50b1F1ZXJ5UGFyYW1z
Ow0KDQp2YXIgJGJyZWFrICAgID0gbmV3IE9iamVjdCgpOw0KdmFyICRjb250aW51ZSA9IG5ldyBP
YmplY3QoKTsNCg0KdmFyIEVudW1lcmFibGUgPSB7DQogIGVhY2g6IGZ1bmN0aW9uKGl0ZXJhdG9y
KSB7DQogICAgdmFyIGluZGV4ID0gMDsNCiAgICB0cnkgew0KICAgICAgdGhpcy5fZWFjaChmdW5j
dGlvbih2YWx1ZSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgIGl0ZXJhdG9yKHZhbHVlLCBp
bmRleCsrKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIGlmIChlICE9ICRjb250
aW51ZSkgdGhyb3cgZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSBjYXRjaCAoZSkgew0K
ICAgICAgaWYgKGUgIT0gJGJyZWFrKSB0aHJvdyBlOw0KICAgIH0NCiAgfSwNCg0KICBhbGw6IGZ1
bmN0aW9uKGl0ZXJhdG9yKSB7DQogICAgdmFyIHJlc3VsdCA9IHRydWU7DQogICAgdGhpcy5lYWNo
KGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgew0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmICEhKGl0
ZXJhdG9yIHx8IFByb3RvdHlwZS5LKSh2YWx1ZSwgaW5kZXgpOw0KICAgICAgaWYgKCFyZXN1bHQp
IHRocm93ICRicmVhazsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9LA0KDQogIGFu
eTogZnVuY3Rpb24oaXRlcmF0b3IpIHsNCiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsNCiAgICB0aGlz
LmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7DQogICAgICBpZiAocmVzdWx0ID0gISEoaXRl
cmF0b3IgfHwgUHJvdG90eXBlLkspKHZhbHVlLCBpbmRleCkpDQogICAgICAgIHRocm93ICRicmVh
azsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9LA0KDQogIGNvbGxlY3Q6IGZ1bmN0
aW9uKGl0ZXJhdG9yKSB7DQogICAgdmFyIHJlc3VsdHMgPSBbXTsNCiAgICB0aGlzLmVhY2goZnVu
Y3Rpb24odmFsdWUsIGluZGV4KSB7DQogICAgICByZXN1bHRzLnB1c2goaXRlcmF0b3IodmFsdWUs
IGluZGV4KSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdHM7DQogIH0sDQoNCiAgZGV0ZWN0
OiBmdW5jdGlvbiAoaXRlcmF0b3IpIHsNCiAgICB2YXIgcmVzdWx0Ow0KICAgIHRoaXMuZWFjaChm
dW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsNCiAgICAgIGlmIChpdGVyYXRvcih2YWx1ZSwgaW5kZXgp
KSB7DQogICAgICAgIHJlc3VsdCA9IHZhbHVlOw0KICAgICAgICB0aHJvdyAkYnJlYWs7DQogICAg
ICB9DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfSwNCg0KICBmaW5kQWxsOiBmdW5j
dGlvbihpdGVyYXRvcikgew0KICAgIHZhciByZXN1bHRzID0gW107DQogICAgdGhpcy5lYWNoKGZ1
bmN0aW9uKHZhbHVlLCBpbmRleCkgew0KICAgICAgaWYgKGl0ZXJhdG9yKHZhbHVlLCBpbmRleCkp
DQogICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7DQogICAgfSk7DQogICAgcmV0dXJuIHJlc3Vs
dHM7DQogIH0sDQoNCiAgZ3JlcDogZnVuY3Rpb24ocGF0dGVybiwgaXRlcmF0b3IpIHsNCiAgICB2
YXIgcmVzdWx0cyA9IFtdOw0KICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsN
CiAgICAgIHZhciBzdHJpbmdWYWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7DQogICAgICBpZiAoc3Ry
aW5nVmFsdWUubWF0Y2gocGF0dGVybikpDQogICAgICAgIHJlc3VsdHMucHVzaCgoaXRlcmF0b3Ig
fHwgUHJvdG90eXBlLkspKHZhbHVlLCBpbmRleCkpOw0KICAgIH0pDQogICAgcmV0dXJuIHJlc3Vs
dHM7DQogIH0sDQoNCiAgaW5jbHVkZTogZnVuY3Rpb24ob2JqZWN0KSB7DQogICAgdmFyIGZvdW5k
ID0gZmFsc2U7DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICBpZiAodmFs
dWUgPT0gb2JqZWN0KSB7DQogICAgICAgIGZvdW5kID0gdHJ1ZTsNCiAgICAgICAgdGhyb3cgJGJy
ZWFrOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIHJldHVybiBmb3VuZDsNCiAgfSwNCg0KICBpbmpl
Y3Q6IGZ1bmN0aW9uKG1lbW8sIGl0ZXJhdG9yKSB7DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZh
bHVlLCBpbmRleCkgew0KICAgICAgbWVtbyA9IGl0ZXJhdG9yKG1lbW8sIHZhbHVlLCBpbmRleCk7
DQogICAgfSk7DQogICAgcmV0dXJuIG1lbW87DQogIH0sDQoNCiAgaW52b2tlOiBmdW5jdGlvbiht
ZXRob2QpIHsNCiAgICB2YXIgYXJncyA9ICRBKGFyZ3VtZW50cykuc2xpY2UoMSk7DQogICAgcmV0
dXJuIHRoaXMuY29sbGVjdChmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgcmV0dXJuIHZhbHVlW21l
dGhvZF0uYXBwbHkodmFsdWUsIGFyZ3MpOw0KICAgIH0pOw0KICB9LA0KDQogIG1heDogZnVuY3Rp
b24oaXRlcmF0b3IpIHsNCiAgICB2YXIgcmVzdWx0Ow0KICAgIHRoaXMuZWFjaChmdW5jdGlvbih2
YWx1ZSwgaW5kZXgpIHsNCiAgICAgIHZhbHVlID0gKGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LKSh2
YWx1ZSwgaW5kZXgpOw0KICAgICAgaWYgKHZhbHVlID49IChyZXN1bHQgfHwgdmFsdWUpKQ0KICAg
ICAgICByZXN1bHQgPSB2YWx1ZTsNCiAgICB9KTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9LA0K
DQogIG1pbjogZnVuY3Rpb24oaXRlcmF0b3IpIHsNCiAgICB2YXIgcmVzdWx0Ow0KICAgIHRoaXMu
ZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsNCiAgICAgIHZhbHVlID0gKGl0ZXJhdG9yIHx8
IFByb3RvdHlwZS5LKSh2YWx1ZSwgaW5kZXgpOw0KICAgICAgaWYgKHZhbHVlIDw9IChyZXN1bHQg
fHwgdmFsdWUpKQ0KICAgICAgICByZXN1bHQgPSB2YWx1ZTsNCiAgICB9KTsNCiAgICByZXR1cm4g
cmVzdWx0Ow0KICB9LA0KDQogIHBhcnRpdGlvbjogZnVuY3Rpb24oaXRlcmF0b3IpIHsNCiAgICB2
YXIgdHJ1ZXMgPSBbXSwgZmFsc2VzID0gW107DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVl
LCBpbmRleCkgew0KICAgICAgKChpdGVyYXRvciB8fCBQcm90b3R5cGUuSykodmFsdWUsIGluZGV4
KSA/DQogICAgICAgIHRydWVzIDogZmFsc2VzKS5wdXNoKHZhbHVlKTsNCiAgICB9KTsNCiAgICBy
ZXR1cm4gW3RydWVzLCBmYWxzZXNdOw0KICB9LA0KDQogIHBsdWNrOiBmdW5jdGlvbihwcm9wZXJ0
eSkgew0KICAgIHZhciByZXN1bHRzID0gW107DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVl
LCBpbmRleCkgew0KICAgICAgcmVzdWx0cy5wdXNoKHZhbHVlW3Byb3BlcnR5XSk7DQogICAgfSk7
DQogICAgcmV0dXJuIHJlc3VsdHM7DQogIH0sDQoNCiAgcmVqZWN0OiBmdW5jdGlvbihpdGVyYXRv
cikgew0KICAgIHZhciByZXN1bHRzID0gW107DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVl
LCBpbmRleCkgew0KICAgICAgaWYgKCFpdGVyYXRvcih2YWx1ZSwgaW5kZXgpKQ0KICAgICAgICBy
ZXN1bHRzLnB1c2godmFsdWUpOw0KICAgIH0pOw0KICAgIHJldHVybiByZXN1bHRzOw0KICB9LA0K
DQogIHNvcnRCeTogZnVuY3Rpb24oaXRlcmF0b3IpIHsNCiAgICByZXR1cm4gdGhpcy5jb2xsZWN0
KGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgew0KICAgICAgcmV0dXJuIHt2YWx1ZTogdmFsdWUsIGNy
aXRlcmlhOiBpdGVyYXRvcih2YWx1ZSwgaW5kZXgpfTsNCiAgICB9KS5zb3J0KGZ1bmN0aW9uKGxl
ZnQsIHJpZ2h0KSB7DQogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWEsIGIgPSByaWdodC5jcml0
ZXJpYTsNCiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDsNCiAgICB9KS5w
bHVjaygndmFsdWUnKTsNCiAgfSwNCg0KICB0b0FycmF5OiBmdW5jdGlvbigpIHsNCiAgICByZXR1
cm4gdGhpcy5jb2xsZWN0KFByb3RvdHlwZS5LKTsNCiAgfSwNCg0KICB6aXA6IGZ1bmN0aW9uKCkg
ew0KICAgIHZhciBpdGVyYXRvciA9IFByb3RvdHlwZS5LLCBhcmdzID0gJEEoYXJndW1lbnRzKTsN
CiAgICBpZiAodHlwZW9mIGFyZ3MubGFzdCgpID09ICdmdW5jdGlvbicpDQogICAgICBpdGVyYXRv
ciA9IGFyZ3MucG9wKCk7DQoNCiAgICB2YXIgY29sbGVjdGlvbnMgPSBbdGhpc10uY29uY2F0KGFy
Z3MpLm1hcCgkQSk7DQogICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkg
ew0KICAgICAgaXRlcmF0b3IodmFsdWUgPSBjb2xsZWN0aW9ucy5wbHVjayhpbmRleCkpOw0KICAg
ICAgcmV0dXJuIHZhbHVlOw0KICAgIH0pOw0KICB9LA0KDQogIGluc3BlY3Q6IGZ1bmN0aW9uKCkg
ew0KICAgIHJldHVybiAnIzxFbnVtZXJhYmxlOicgKyB0aGlzLnRvQXJyYXkoKS5pbnNwZWN0KCkg
KyAnPic7DQogIH0NCn0NCg0KT2JqZWN0LmV4dGVuZChFbnVtZXJhYmxlLCB7DQogIG1hcDogICAg
IEVudW1lcmFibGUuY29sbGVjdCwNCiAgZmluZDogICAgRW51bWVyYWJsZS5kZXRlY3QsDQogIHNl
bGVjdDogIEVudW1lcmFibGUuZmluZEFsbCwNCiAgbWVtYmVyOiAgRW51bWVyYWJsZS5pbmNsdWRl
LA0KICBlbnRyaWVzOiBFbnVtZXJhYmxlLnRvQXJyYXkNCn0pOw0KdmFyICRBID0gQXJyYXkuZnJv
bSA9IGZ1bmN0aW9uKGl0ZXJhYmxlKSB7DQogIGlmICghaXRlcmFibGUpIHJldHVybiBbXTsNCiAg
aWYgKGl0ZXJhYmxlLnRvQXJyYXkpIHsNCiAgICByZXR1cm4gaXRlcmFibGUudG9BcnJheSgpOw0K
ICB9IGVsc2Ugew0KICAgIHZhciByZXN1bHRzID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkg
PCBpdGVyYWJsZS5sZW5ndGg7IGkrKykNCiAgICAgIHJlc3VsdHMucHVzaChpdGVyYWJsZVtpXSk7
DQogICAgcmV0dXJuIHJlc3VsdHM7DQogIH0NCn0NCg0KT2JqZWN0LmV4dGVuZChBcnJheS5wcm90
b3R5cGUsIEVudW1lcmFibGUpOw0KDQpBcnJheS5wcm90b3R5cGUuX3JldmVyc2UgPSBBcnJheS5w
cm90b3R5cGUucmV2ZXJzZTsNCg0KT2JqZWN0LmV4dGVuZChBcnJheS5wcm90b3R5cGUsIHsNCiAg
X2VhY2g6IGZ1bmN0aW9uKGl0ZXJhdG9yKSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlz
Lmxlbmd0aDsgaSsrKQ0KICAgICAgaXRlcmF0b3IodGhpc1tpXSk7DQogIH0sDQoNCiAgY2xlYXI6
IGZ1bmN0aW9uKCkgew0KICAgIHRoaXMubGVuZ3RoID0gMDsNCiAgICByZXR1cm4gdGhpczsNCiAg
fSwNCg0KICBmaXJzdDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXNbMF07DQogIH0sDQoN
CiAgbGFzdDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXNbdGhpcy5sZW5ndGggLSAxXTsN
CiAgfSwNCg0KICBjb21wYWN0OiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5zZWxlY3Qo
ZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgIHJldHVybiB2YWx1ZSAhPSB1bmRlZmluZWQgfHwgdmFs
dWUgIT0gbnVsbDsNCiAgICB9KTsNCiAgfSwNCg0KICBmbGF0dGVuOiBmdW5jdGlvbigpIHsNCiAg
ICByZXR1cm4gdGhpcy5pbmplY3QoW10sIGZ1bmN0aW9uKGFycmF5LCB2YWx1ZSkgew0KICAgICAg
cmV0dXJuIGFycmF5LmNvbmNhdCh2YWx1ZS5jb25zdHJ1Y3RvciA9PSBBcnJheSA/DQogICAgICAg
IHZhbHVlLmZsYXR0ZW4oKSA6IFt2YWx1ZV0pOw0KICAgIH0pOw0KICB9LA0KDQogIHdpdGhvdXQ6
IGZ1bmN0aW9uKCkgew0KICAgIHZhciB2YWx1ZXMgPSAkQShhcmd1bWVudHMpOw0KICAgIHJldHVy
biB0aGlzLnNlbGVjdChmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgcmV0dXJuICF2YWx1ZXMuaW5j
bHVkZSh2YWx1ZSk7DQogICAgfSk7DQogIH0sDQoNCiAgaW5kZXhPZjogZnVuY3Rpb24ob2JqZWN0
KSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKQ0KICAgICAgaWYg
KHRoaXNbaV0gPT0gb2JqZWN0KSByZXR1cm4gaTsNCiAgICByZXR1cm4gLTE7DQogIH0sDQoNCiAg
cmV2ZXJzZTogZnVuY3Rpb24oaW5saW5lKSB7DQogICAgcmV0dXJuIChpbmxpbmUgIT09IGZhbHNl
ID8gdGhpcyA6IHRoaXMudG9BcnJheSgpKS5fcmV2ZXJzZSgpOw0KICB9LA0KDQogIHNoaWZ0OiBm
dW5jdGlvbigpIHsNCiAgICB2YXIgcmVzdWx0ID0gdGhpc1swXTsNCiAgICBmb3IgKHZhciBpID0g
MDsgaSA8IHRoaXMubGVuZ3RoIC0gMTsgaSsrKQ0KICAgICAgdGhpc1tpXSA9IHRoaXNbaSArIDFd
Ow0KICAgIHRoaXMubGVuZ3RoLS07DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfSwNCg0KICBpbnNw
ZWN0OiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gJ1snICsgdGhpcy5tYXAoT2JqZWN0Lmluc3Bl
Y3QpLmpvaW4oJywgJykgKyAnXSc7DQogIH0NCn0pOw0KdmFyIEhhc2ggPSB7DQogIF9lYWNoOiBm
dW5jdGlvbihpdGVyYXRvcikgew0KICAgIGZvciAoa2V5IGluIHRoaXMpIHsNCiAgICAgIHZhciB2
YWx1ZSA9IHRoaXNba2V5XTsNCiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJykg
Y29udGludWU7DQoNCiAgICAgIHZhciBwYWlyID0gW2tleSwgdmFsdWVdOw0KICAgICAgcGFpci5r
ZXkgPSBrZXk7DQogICAgICBwYWlyLnZhbHVlID0gdmFsdWU7DQogICAgICBpdGVyYXRvcihwYWly
KTsNCiAgICB9DQogIH0sDQoNCiAga2V5czogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHRoaXMu
cGx1Y2soJ2tleScpOw0KICB9LA0KDQogIHZhbHVlczogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJu
IHRoaXMucGx1Y2soJ3ZhbHVlJyk7DQogIH0sDQoNCiAgbWVyZ2U6IGZ1bmN0aW9uKGhhc2gpIHsN
CiAgICByZXR1cm4gJEgoaGFzaCkuaW5qZWN0KCRIKHRoaXMpLCBmdW5jdGlvbihtZXJnZWRIYXNo
LCBwYWlyKSB7DQogICAgICBtZXJnZWRIYXNoW3BhaXIua2V5XSA9IHBhaXIudmFsdWU7DQogICAg
ICByZXR1cm4gbWVyZ2VkSGFzaDsNCiAgICB9KTsNCiAgfSwNCg0KICB0b1F1ZXJ5U3RyaW5nOiBm
dW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24ocGFpcikgew0KICAgICAg
cmV0dXJuIHBhaXIubWFwKGVuY29kZVVSSUNvbXBvbmVudCkuam9pbignPScpOw0KICAgIH0pLmpv
aW4oJyYnKTsNCiAgfSwNCg0KICBpbnNwZWN0OiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gJyM8
SGFzaDp7JyArIHRoaXMubWFwKGZ1bmN0aW9uKHBhaXIpIHsNCiAgICAgIHJldHVybiBwYWlyLm1h
cChPYmplY3QuaW5zcGVjdCkuam9pbignOiAnKTsNCiAgICB9KS5qb2luKCcsICcpICsgJ30+JzsN
CiAgfQ0KfQ0KDQpmdW5jdGlvbiAkSChvYmplY3QpIHsNCiAgdmFyIGhhc2ggPSBPYmplY3QuZXh0
ZW5kKHt9LCBvYmplY3QgfHwge30pOw0KICBPYmplY3QuZXh0ZW5kKGhhc2gsIEVudW1lcmFibGUp
Ow0KICBPYmplY3QuZXh0ZW5kKGhhc2gsIEhhc2gpOw0KICByZXR1cm4gaGFzaDsNCn0NCk9iamVj
dFJhbmdlID0gQ2xhc3MuY3JlYXRlKCk7DQpPYmplY3QuZXh0ZW5kKE9iamVjdFJhbmdlLnByb3Rv
dHlwZSwgRW51bWVyYWJsZSk7DQpPYmplY3QuZXh0ZW5kKE9iamVjdFJhbmdlLnByb3RvdHlwZSwg
ew0KICBpbml0aWFsaXplOiBmdW5jdGlvbihzdGFydCwgZW5kLCBleGNsdXNpdmUpIHsNCiAgICB0
aGlzLnN0YXJ0ID0gc3RhcnQ7DQogICAgdGhpcy5lbmQgPSBlbmQ7DQogICAgdGhpcy5leGNsdXNp
dmUgPSBleGNsdXNpdmU7DQogIH0sDQoNCiAgX2VhY2g6IGZ1bmN0aW9uKGl0ZXJhdG9yKSB7DQog
ICAgdmFyIHZhbHVlID0gdGhpcy5zdGFydDsNCiAgICBkbyB7DQogICAgICBpdGVyYXRvcih2YWx1
ZSk7DQogICAgICB2YWx1ZSA9IHZhbHVlLnN1Y2MoKTsNCiAgICB9IHdoaWxlICh0aGlzLmluY2x1
ZGUodmFsdWUpKTsNCiAgfSwNCg0KICBpbmNsdWRlOiBmdW5jdGlvbih2YWx1ZSkgew0KICAgIGlm
ICh2YWx1ZSA8IHRoaXMuc3RhcnQpDQogICAgICByZXR1cm4gZmFsc2U7DQogICAgaWYgKHRoaXMu
ZXhjbHVzaXZlKQ0KICAgICAgcmV0dXJuIHZhbHVlIDwgdGhpcy5lbmQ7DQogICAgcmV0dXJuIHZh
bHVlIDw9IHRoaXMuZW5kOw0KICB9DQp9KTsNCg0KdmFyICRSID0gZnVuY3Rpb24oc3RhcnQsIGVu
ZCwgZXhjbHVzaXZlKSB7DQogIHJldHVybiBuZXcgT2JqZWN0UmFuZ2Uoc3RhcnQsIGVuZCwgZXhj
bHVzaXZlKTsNCn0NCg0KdmFyIEFqYXggPSB7DQogIGdldFRyYW5zcG9ydDogZnVuY3Rpb24oKSB7
DQogICAgcmV0dXJuIFRyeS50aGVzZSgNCiAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBuZXcgQWN0
aXZlWE9iamVjdCgnTXN4bWwyLlhNTEhUVFAnKX0sDQogICAgICBmdW5jdGlvbigpIHtyZXR1cm4g
bmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyl9LA0KICAgICAgZnVuY3Rpb24o
KSB7cmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpfQ0KICAgICkgfHwgZmFsc2U7DQogIH0sDQoN
CiAgYWN0aXZlUmVxdWVzdENvdW50OiAwDQp9DQoNCkFqYXguUmVzcG9uZGVycyA9IHsNCiAgcmVz
cG9uZGVyczogW10sDQoNCiAgX2VhY2g6IGZ1bmN0aW9uKGl0ZXJhdG9yKSB7DQogICAgdGhpcy5y
ZXNwb25kZXJzLl9lYWNoKGl0ZXJhdG9yKTsNCiAgfSwNCg0KICByZWdpc3RlcjogZnVuY3Rpb24o
cmVzcG9uZGVyVG9BZGQpIHsNCiAgICBpZiAoIXRoaXMuaW5jbHVkZShyZXNwb25kZXJUb0FkZCkp
DQogICAgICB0aGlzLnJlc3BvbmRlcnMucHVzaChyZXNwb25kZXJUb0FkZCk7DQogIH0sDQoNCiAg
dW5yZWdpc3RlcjogZnVuY3Rpb24ocmVzcG9uZGVyVG9SZW1vdmUpIHsNCiAgICB0aGlzLnJlc3Bv
bmRlcnMgPSB0aGlzLnJlc3BvbmRlcnMud2l0aG91dChyZXNwb25kZXJUb1JlbW92ZSk7DQogIH0s
DQoNCiAgZGlzcGF0Y2g6IGZ1bmN0aW9uKGNhbGxiYWNrLCByZXF1ZXN0LCB0cmFuc3BvcnQsIGpz
b24pIHsNCiAgICB0aGlzLmVhY2goZnVuY3Rpb24ocmVzcG9uZGVyKSB7DQogICAgICBpZiAocmVz
cG9uZGVyW2NhbGxiYWNrXSAmJiB0eXBlb2YgcmVzcG9uZGVyW2NhbGxiYWNrXSA9PSAnZnVuY3Rp
b24nKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcmVzcG9uZGVyW2NhbGxiYWNrXS5hcHBs
eShyZXNwb25kZXIsIFtyZXF1ZXN0LCB0cmFuc3BvcnQsIGpzb25dKTsNCiAgICAgICAgfSBjYXRj
aCAoZSkge30NCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KfTsNCg0KT2JqZWN0LmV4dGVuZChBamF4
LlJlc3BvbmRlcnMsIEVudW1lcmFibGUpOw0KDQpBamF4LlJlc3BvbmRlcnMucmVnaXN0ZXIoew0K
ICBvbkNyZWF0ZTogZnVuY3Rpb24oKSB7DQogICAgQWpheC5hY3RpdmVSZXF1ZXN0Q291bnQrKzsN
CiAgfSwNCg0KICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHsNCiAgICBBamF4LmFjdGl2ZVJlcXVl
c3RDb3VudC0tOw0KICB9DQp9KTsNCg0KQWpheC5CYXNlID0gZnVuY3Rpb24oKSB7fTsNCkFqYXgu
QmFzZS5wcm90b3R5cGUgPSB7DQogIHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAg
ICB0aGlzLm9wdGlvbnMgPSB7DQogICAgICBtZXRob2Q6ICAgICAgICdwb3N0JywNCiAgICAgIGFz
eW5jaHJvbm91czogdHJ1ZSwNCiAgICAgIHBhcmFtZXRlcnM6ICAgJycNCiAgICB9DQogICAgT2Jq
ZWN0LmV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMgfHwge30pOw0KICB9LA0KDQogIHJlc3Bv
bnNlSXNTdWNjZXNzOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuc3Rh
dHVzID09IHVuZGVmaW5lZA0KICAgICAgICB8fCB0aGlzLnRyYW5zcG9ydC5zdGF0dXMgPT0gMA0K
ICAgICAgICB8fCAodGhpcy50cmFuc3BvcnQuc3RhdHVzID49IDIwMCAmJiB0aGlzLnRyYW5zcG9y
dC5zdGF0dXMgPCAzMDApOw0KICB9LA0KDQogIHJlc3BvbnNlSXNGYWlsdXJlOiBmdW5jdGlvbigp
IHsNCiAgICByZXR1cm4gIXRoaXMucmVzcG9uc2VJc1N1Y2Nlc3MoKTsNCiAgfQ0KfQ0KDQpBamF4
LlJlcXVlc3QgPSBDbGFzcy5jcmVhdGUoKTsNCkFqYXguUmVxdWVzdC5FdmVudHMgPQ0KICBbJ1Vu
aW5pdGlhbGl6ZWQnLCAnTG9hZGluZycsICdMb2FkZWQnLCAnSW50ZXJhY3RpdmUnLCAnQ29tcGxl
dGUnXTsNCg0KQWpheC5SZXF1ZXN0LnByb3RvdHlwZSA9IE9iamVjdC5leHRlbmQobmV3IEFqYXgu
QmFzZSgpLCB7DQogIGluaXRpYWxpemU6IGZ1bmN0aW9uKHVybCwgb3B0aW9ucykgew0KICAgIHRo
aXMudHJhbnNwb3J0ID0gQWpheC5nZXRUcmFuc3BvcnQoKTsNCiAgICB0aGlzLnNldE9wdGlvbnMo
b3B0aW9ucyk7DQogICAgdGhpcy5yZXF1ZXN0KHVybCk7DQogIH0sDQoNCiAgcmVxdWVzdDogZnVu
Y3Rpb24odXJsKSB7DQogICAgdmFyIHBhcmFtZXRlcnMgPSB0aGlzLm9wdGlvbnMucGFyYW1ldGVy
cyB8fCAnJzsNCiAgICBpZiAocGFyYW1ldGVycy5sZW5ndGggPiAwKSBwYXJhbWV0ZXJzICs9ICcm
Xz0nOw0KDQogICAgdHJ5IHsNCiAgICAgIHRoaXMudXJsID0gdXJsOw0KICAgICAgaWYgKHRoaXMu
b3B0aW9ucy5tZXRob2QgPT0gJ2dldCcgJiYgcGFyYW1ldGVycy5sZW5ndGggPiAwKQ0KICAgICAg
ICB0aGlzLnVybCArPSAodGhpcy51cmwubWF0Y2goL1w/LykgPyAnJicgOiAnPycpICsgcGFyYW1l
dGVyczsNCg0KICAgICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbkNyZWF0ZScsIHRoaXMs
IHRoaXMudHJhbnNwb3J0KTsNCg0KICAgICAgdGhpcy50cmFuc3BvcnQub3Blbih0aGlzLm9wdGlv
bnMubWV0aG9kLCB0aGlzLnVybCwNCiAgICAgICAgdGhpcy5vcHRpb25zLmFzeW5jaHJvbm91cyk7
DQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXN5bmNocm9ub3VzKSB7DQogICAgICAgIHRoaXMu
dHJhbnNwb3J0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMub25TdGF0ZUNoYW5nZS5iaW5kKHRo
aXMpOw0KICAgICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHt0aGlzLnJlc3BvbmRUb1JlYWR5
U3RhdGUoMSl9KS5iaW5kKHRoaXMpLCAxMCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuc2V0UmVx
dWVzdEhlYWRlcnMoKTsNCg0KICAgICAgdmFyIGJvZHkgPSB0aGlzLm9wdGlvbnMucG9zdEJvZHkg
PyB0aGlzLm9wdGlvbnMucG9zdEJvZHkgOiBwYXJhbWV0ZXJzOw0KICAgICAgdGhpcy50cmFuc3Bv
cnQuc2VuZCh0aGlzLm9wdGlvbnMubWV0aG9kID09ICdwb3N0JyA/IGJvZHkgOiBudWxsKTsNCg0K
ICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIHRoaXMuZGlzcGF0Y2hFeGNlcHRpb24oZSk7DQogICAg
fQ0KICB9LA0KDQogIHNldFJlcXVlc3RIZWFkZXJzOiBmdW5jdGlvbigpIHsNCiAgICB2YXIgcmVx
dWVzdEhlYWRlcnMgPQ0KICAgICAgWydYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0
JywNCiAgICAgICAnWC1Qcm90b3R5cGUtVmVyc2lvbicsIFByb3RvdHlwZS5WZXJzaW9uXTsNCg0K
ICAgIGlmICh0aGlzLm9wdGlvbnMubWV0aG9kID09ICdwb3N0Jykgew0KICAgICAgcmVxdWVzdEhl
YWRlcnMucHVzaCgnQ29udGVudC10eXBlJywNCiAgICAgICAgJ2FwcGxpY2F0aW9uL3gtd3d3LWZv
cm0tdXJsZW5jb2RlZCcpOw0KDQogICAgICAvKiBGb3JjZSAiQ29ubmVjdGlvbjogY2xvc2UiIGZv
ciBNb3ppbGxhIGJyb3dzZXJzIHRvIHdvcmsgYXJvdW5kDQogICAgICAgKiBhIGJ1ZyB3aGVyZSBY
TUxIdHRwUmVxZXVlc3Qgc2VuZHMgYW4gaW5jb3JyZWN0IENvbnRlbnQtbGVuZ3RoDQogICAgICAg
KiBoZWFkZXIuIFNlZSBNb3ppbGxhIEJ1Z3ppbGxhICMyNDY2NTEuDQogICAgICAgKi8NCiAgICAg
IGlmICh0aGlzLnRyYW5zcG9ydC5vdmVycmlkZU1pbWVUeXBlKQ0KICAgICAgICByZXF1ZXN0SGVh
ZGVycy5wdXNoKCdDb25uZWN0aW9uJywgJ2Nsb3NlJyk7DQogICAgfQ0KDQogICAgaWYgKHRoaXMu
b3B0aW9ucy5yZXF1ZXN0SGVhZGVycykNCiAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2guYXBwbHko
cmVxdWVzdEhlYWRlcnMsIHRoaXMub3B0aW9ucy5yZXF1ZXN0SGVhZGVycyk7DQoNCiAgICBmb3Ig
KHZhciBpID0gMDsgaSA8IHJlcXVlc3RIZWFkZXJzLmxlbmd0aDsgaSArPSAyKQ0KICAgICAgdGhp
cy50cmFuc3BvcnQuc2V0UmVxdWVzdEhlYWRlcihyZXF1ZXN0SGVhZGVyc1tpXSwgcmVxdWVzdEhl
YWRlcnNbaSsxXSk7DQogIH0sDQoNCiAgb25TdGF0ZUNoYW5nZTogZnVuY3Rpb24oKSB7DQogICAg
dmFyIHJlYWR5U3RhdGUgPSB0aGlzLnRyYW5zcG9ydC5yZWFkeVN0YXRlOw0KICAgIGlmIChyZWFk
eVN0YXRlICE9IDEpDQogICAgICB0aGlzLnJlc3BvbmRUb1JlYWR5U3RhdGUodGhpcy50cmFuc3Bv
cnQucmVhZHlTdGF0ZSk7DQogIH0sDQoNCiAgaGVhZGVyOiBmdW5jdGlvbihuYW1lKSB7DQogICAg
dHJ5IHsNCiAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5nZXRSZXNwb25zZUhlYWRlcihuYW1l
KTsNCiAgICB9IGNhdGNoIChlKSB7fQ0KICB9LA0KDQogIGV2YWxKU09OOiBmdW5jdGlvbigpIHsN
CiAgICB0cnkgew0KICAgICAgcmV0dXJuIGV2YWwodGhpcy5oZWFkZXIoJ1gtSlNPTicpKTsNCiAg
ICB9IGNhdGNoIChlKSB7fQ0KICB9LA0KDQogIGV2YWxSZXNwb25zZTogZnVuY3Rpb24oKSB7DQog
ICAgdHJ5IHsNCiAgICAgIHJldHVybiBldmFsKHRoaXMudHJhbnNwb3J0LnJlc3BvbnNlVGV4dCk7
DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgdGhpcy5kaXNwYXRjaEV4Y2VwdGlvbihlKTsNCiAg
ICB9DQogIH0sDQoNCiAgcmVzcG9uZFRvUmVhZHlTdGF0ZTogZnVuY3Rpb24ocmVhZHlTdGF0ZSkg
ew0KICAgIHZhciBldmVudCA9IEFqYXguUmVxdWVzdC5FdmVudHNbcmVhZHlTdGF0ZV07DQogICAg
dmFyIHRyYW5zcG9ydCA9IHRoaXMudHJhbnNwb3J0LCBqc29uID0gdGhpcy5ldmFsSlNPTigpOw0K
DQogICAgaWYgKGV2ZW50ID09ICdDb21wbGV0ZScpIHsNCiAgICAgIHRyeSB7DQogICAgICAgICh0
aGlzLm9wdGlvbnNbJ29uJyArIHRoaXMudHJhbnNwb3J0LnN0YXR1c10NCiAgICAgICAgIHx8IHRo
aXMub3B0aW9uc1snb24nICsgKHRoaXMucmVzcG9uc2VJc1N1Y2Nlc3MoKSA/ICdTdWNjZXNzJyA6
ICdGYWlsdXJlJyldDQogICAgICAgICB8fCBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbikodHJhbnNw
b3J0LCBqc29uKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhpcy5kaXNwYXRjaEV4
Y2VwdGlvbihlKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCh0aGlzLmhlYWRlcignQ29udGVudC10
eXBlJykgfHwgJycpLm1hdGNoKC9edGV4dFwvamF2YXNjcmlwdC9pKSkNCiAgICAgICAgdGhpcy5l
dmFsUmVzcG9uc2UoKTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgKHRoaXMub3B0aW9uc1sn
b24nICsgZXZlbnRdIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKSh0cmFuc3BvcnQsIGpzb24p
Ow0KICAgICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbicgKyBldmVudCwgdGhpcywgdHJh
bnNwb3J0LCBqc29uKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICB0aGlzLmRpc3BhdGNoRXhj
ZXB0aW9uKGUpOw0KICAgIH0NCg0KICAgIC8qIEF2b2lkIG1lbW9yeSBsZWFrIGluIE1TSUU6IGNs
ZWFuIHVwIHRoZSBvbmNvbXBsZXRlIGV2ZW50IGhhbmRsZXIgKi8NCiAgICBpZiAoZXZlbnQgPT0g
J0NvbXBsZXRlJykNCiAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IFBy
b3RvdHlwZS5lbXB0eUZ1bmN0aW9uOw0KICB9LA0KDQogIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5j
dGlvbihleGNlcHRpb24pIHsNCiAgICAodGhpcy5vcHRpb25zLm9uRXhjZXB0aW9uIHx8IFByb3Rv
dHlwZS5lbXB0eUZ1bmN0aW9uKSh0aGlzLCBleGNlcHRpb24pOw0KICAgIEFqYXguUmVzcG9uZGVy
cy5kaXNwYXRjaCgnb25FeGNlcHRpb24nLCB0aGlzLCBleGNlcHRpb24pOw0KICB9DQp9KTsNCg0K
QWpheC5VcGRhdGVyID0gQ2xhc3MuY3JlYXRlKCk7DQoNCk9iamVjdC5leHRlbmQoT2JqZWN0LmV4
dGVuZChBamF4LlVwZGF0ZXIucHJvdG90eXBlLCBBamF4LlJlcXVlc3QucHJvdG90eXBlKSwgew0K
ICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIHVybCwgb3B0aW9ucykgew0KICAgIHRo
aXMuY29udGFpbmVycyA9IHsNCiAgICAgIHN1Y2Nlc3M6IGNvbnRhaW5lci5zdWNjZXNzID8gJChj
b250YWluZXIuc3VjY2VzcykgOiAkKGNvbnRhaW5lciksDQogICAgICBmYWlsdXJlOiBjb250YWlu
ZXIuZmFpbHVyZSA/ICQoY29udGFpbmVyLmZhaWx1cmUpIDoNCiAgICAgICAgKGNvbnRhaW5lci5z
dWNjZXNzID8gbnVsbCA6ICQoY29udGFpbmVyKSkNCiAgICB9DQoNCiAgICB0aGlzLnRyYW5zcG9y
dCA9IEFqYXguZ2V0VHJhbnNwb3J0KCk7DQogICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOw0K
DQogICAgdmFyIG9uQ29tcGxldGUgPSB0aGlzLm9wdGlvbnMub25Db21wbGV0ZSB8fCBQcm90b3R5
cGUuZW1wdHlGdW5jdGlvbjsNCiAgICB0aGlzLm9wdGlvbnMub25Db21wbGV0ZSA9IChmdW5jdGlv
bih0cmFuc3BvcnQsIG9iamVjdCkgew0KICAgICAgdGhpcy51cGRhdGVDb250ZW50KCk7DQogICAg
ICBvbkNvbXBsZXRlKHRyYW5zcG9ydCwgb2JqZWN0KTsNCiAgICB9KS5iaW5kKHRoaXMpOw0KDQog
ICAgdGhpcy5yZXF1ZXN0KHVybCk7DQogIH0sDQoNCiAgdXBkYXRlQ29udGVudDogZnVuY3Rpb24o
KSB7DQogICAgdmFyIHJlY2VpdmVyID0gdGhpcy5yZXNwb25zZUlzU3VjY2VzcygpID8NCiAgICAg
IHRoaXMuY29udGFpbmVycy5zdWNjZXNzIDogdGhpcy5jb250YWluZXJzLmZhaWx1cmU7DQogICAg
dmFyIHJlc3BvbnNlID0gdGhpcy50cmFuc3BvcnQucmVzcG9uc2VUZXh0Ow0KDQogICAgaWYgKCF0
aGlzLm9wdGlvbnMuZXZhbFNjcmlwdHMpDQogICAgICByZXNwb25zZSA9IHJlc3BvbnNlLnN0cmlw
U2NyaXB0cygpOw0KDQogICAgaWYgKHJlY2VpdmVyKSB7DQogICAgICBpZiAodGhpcy5vcHRpb25z
Lmluc2VydGlvbikgew0KICAgICAgICBuZXcgdGhpcy5vcHRpb25zLmluc2VydGlvbihyZWNlaXZl
ciwgcmVzcG9uc2UpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgRWxlbWVudC51cGRhdGUocmVj
ZWl2ZXIsIHJlc3BvbnNlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodGhpcy5yZXNwb25z
ZUlzU3VjY2VzcygpKSB7DQogICAgICBpZiAodGhpcy5vbkNvbXBsZXRlKQ0KICAgICAgICBzZXRU
aW1lb3V0KHRoaXMub25Db21wbGV0ZS5iaW5kKHRoaXMpLCAxMCk7DQogICAgfQ0KICB9DQp9KTsN
Cg0KQWpheC5QZXJpb2RpY2FsVXBkYXRlciA9IENsYXNzLmNyZWF0ZSgpOw0KQWpheC5QZXJpb2Rp
Y2FsVXBkYXRlci5wcm90b3R5cGUgPSBPYmplY3QuZXh0ZW5kKG5ldyBBamF4LkJhc2UoKSwgew0K
ICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIHVybCwgb3B0aW9ucykgew0KICAgIHRo
aXMuc2V0T3B0aW9ucyhvcHRpb25zKTsNCiAgICB0aGlzLm9uQ29tcGxldGUgPSB0aGlzLm9wdGlv
bnMub25Db21wbGV0ZTsNCg0KICAgIHRoaXMuZnJlcXVlbmN5ID0gKHRoaXMub3B0aW9ucy5mcmVx
dWVuY3kgfHwgMik7DQogICAgdGhpcy5kZWNheSA9ICh0aGlzLm9wdGlvbnMuZGVjYXkgfHwgMSk7
DQoNCiAgICB0aGlzLnVwZGF0ZXIgPSB7fTsNCiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5l
cjsNCiAgICB0aGlzLnVybCA9IHVybDsNCg0KICAgIHRoaXMuc3RhcnQoKTsNCiAgfSwNCg0KICBz
dGFydDogZnVuY3Rpb24oKSB7DQogICAgdGhpcy5vcHRpb25zLm9uQ29tcGxldGUgPSB0aGlzLnVw
ZGF0ZUNvbXBsZXRlLmJpbmQodGhpcyk7DQogICAgdGhpcy5vblRpbWVyRXZlbnQoKTsNCiAgfSwN
Cg0KICBzdG9wOiBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnVwZGF0ZXIub25Db21wbGV0ZSA9IHVu
ZGVmaW5lZDsNCiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7DQogICAgKHRoaXMub25Db21w
bGV0ZSB8fCBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbikuYXBwbHkodGhpcywgYXJndW1lbnRzKTsN
CiAgfSwNCg0KICB1cGRhdGVDb21wbGV0ZTogZnVuY3Rpb24ocmVxdWVzdCkgew0KICAgIGlmICh0
aGlzLm9wdGlvbnMuZGVjYXkpIHsNCiAgICAgIHRoaXMuZGVjYXkgPSAocmVxdWVzdC5yZXNwb25z
ZVRleHQgPT0gdGhpcy5sYXN0VGV4dCA/DQogICAgICAgIHRoaXMuZGVjYXkgKiB0aGlzLm9wdGlv
bnMuZGVjYXkgOiAxKTsNCg0KICAgICAgdGhpcy5sYXN0VGV4dCA9IHJlcXVlc3QucmVzcG9uc2VU
ZXh0Ow0KICAgIH0NCiAgICB0aGlzLnRpbWVyID0gc2V0VGltZW91dCh0aGlzLm9uVGltZXJFdmVu
dC5iaW5kKHRoaXMpLA0KICAgICAgdGhpcy5kZWNheSAqIHRoaXMuZnJlcXVlbmN5ICogMTAwMCk7
DQogIH0sDQoNCiAgb25UaW1lckV2ZW50OiBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnVwZGF0ZXIg
PSBuZXcgQWpheC5VcGRhdGVyKHRoaXMuY29udGFpbmVyLCB0aGlzLnVybCwgdGhpcy5vcHRpb25z
KTsNCiAgfQ0KfSk7DQpkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gZnVuY3Rpb24o
Y2xhc3NOYW1lLCBwYXJlbnRFbGVtZW50KSB7DQogIHZhciBjaGlsZHJlbiA9ICgkKHBhcmVudEVs
ZW1lbnQpIHx8IGRvY3VtZW50LmJvZHkpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7DQogIHJl
dHVybiAkQShjaGlsZHJlbikuaW5qZWN0KFtdLCBmdW5jdGlvbihlbGVtZW50cywgY2hpbGQpIHsN
CiAgICBpZiAoY2hpbGQuY2xhc3NOYW1lLm1hdGNoKG5ldyBSZWdFeHAoIihefFxccykiICsgY2xh
c3NOYW1lICsgIihcXHN8JCkiKSkpDQogICAgICBlbGVtZW50cy5wdXNoKGNoaWxkKTsNCiAgICBy
ZXR1cm4gZWxlbWVudHM7DQogIH0pOw0KfQ0KDQovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KaWYg
KCF3aW5kb3cuRWxlbWVudCkgew0KICB2YXIgRWxlbWVudCA9IG5ldyBPYmplY3QoKTsNCn0NCg0K
T2JqZWN0LmV4dGVuZChFbGVtZW50LCB7DQogIHZpc2libGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsN
CiAgICByZXR1cm4gJChlbGVtZW50KS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJzsNCiAgfSwNCg0K
ICB0b2dnbGU6IGZ1bmN0aW9uKCkgew0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRz
Lmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgZWxlbWVudCA9ICQoYXJndW1lbnRzW2ldKTsNCiAg
ICAgIEVsZW1lbnRbRWxlbWVudC52aXNpYmxlKGVsZW1lbnQpID8gJ2hpZGUnIDogJ3Nob3cnXShl
bGVtZW50KTsNCiAgICB9DQogIH0sDQoNCiAgaGlkZTogZnVuY3Rpb24oKSB7DQogICAgZm9yICh2
YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBlbGVtZW50
ID0gJChhcmd1bWVudHNbaV0pOw0KICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUn
Ow0KICAgIH0NCiAgfSwNCg0KICBzaG93OiBmdW5jdGlvbigpIHsNCiAgICBmb3IgKHZhciBpID0g
MDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGVsZW1lbnQgPSAkKGFy
Z3VtZW50c1tpXSk7DQogICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJzsNCiAgICB9DQog
IH0sDQoNCiAgcmVtb3ZlOiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxlbWVudCA9ICQoZWxl
bWVudCk7DQogICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpOw0KICB9
LA0KDQogIHVwZGF0ZTogZnVuY3Rpb24oZWxlbWVudCwgaHRtbCkgew0KICAgICQoZWxlbWVudCku
aW5uZXJIVE1MID0gaHRtbC5zdHJpcFNjcmlwdHMoKTsNCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9u
KCkge2h0bWwuZXZhbFNjcmlwdHMoKX0sIDEwKTsNCiAgfSwNCg0KICBnZXRIZWlnaHQ6IGZ1bmN0
aW9uKGVsZW1lbnQpIHsNCiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsNCiAgICByZXR1cm4gZWxl
bWVudC5vZmZzZXRIZWlnaHQ7DQogIH0sDQoNCiAgY2xhc3NOYW1lczogZnVuY3Rpb24oZWxlbWVu
dCkgew0KICAgIHJldHVybiBuZXcgRWxlbWVudC5DbGFzc05hbWVzKGVsZW1lbnQpOw0KICB9LA0K
DQogIGhhc0NsYXNzTmFtZTogZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7DQogICAgaWYg
KCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47DQogICAgcmV0dXJuIEVsZW1lbnQuY2xh
c3NOYW1lcyhlbGVtZW50KS5pbmNsdWRlKGNsYXNzTmFtZSk7DQogIH0sDQoNCiAgYWRkQ2xhc3NO
YW1lOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsNCiAgICBpZiAoIShlbGVtZW50ID0g
JChlbGVtZW50KSkpIHJldHVybjsNCiAgICByZXR1cm4gRWxlbWVudC5jbGFzc05hbWVzKGVsZW1l
bnQpLmFkZChjbGFzc05hbWUpOw0KICB9LA0KDQogIHJlbW92ZUNsYXNzTmFtZTogZnVuY3Rpb24o
ZWxlbWVudCwgY2xhc3NOYW1lKSB7DQogICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSBy
ZXR1cm47DQogICAgcmV0dXJuIEVsZW1lbnQuY2xhc3NOYW1lcyhlbGVtZW50KS5yZW1vdmUoY2xh
c3NOYW1lKTsNCiAgfSwNCg0KICAvLyByZW1vdmVzIHdoaXRlc3BhY2Utb25seSB0ZXh0IG5vZGUg
Y2hpbGRyZW4NCiAgY2xlYW5XaGl0ZXNwYWNlOiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxl
bWVudCA9ICQoZWxlbWVudCk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50LmNoaWxk
Tm9kZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBub2RlID0gZWxlbWVudC5jaGlsZE5vZGVz
W2ldOw0KICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMyAmJiAhL1xTLy50ZXN0KG5vZGUubm9k
ZVZhbHVlKSkNCiAgICAgICAgRWxlbWVudC5yZW1vdmUobm9kZSk7DQogICAgfQ0KICB9LA0KDQog
IGVtcHR5OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgcmV0dXJuICQoZWxlbWVudCkuaW5uZXJI
VE1MLm1hdGNoKC9eXHMqJC8pOw0KICB9LA0KDQogIHNjcm9sbFRvOiBmdW5jdGlvbihlbGVtZW50
KSB7DQogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7DQogICAgdmFyIHggPSBlbGVtZW50LnggPyBl
bGVtZW50LnggOiBlbGVtZW50Lm9mZnNldExlZnQsDQogICAgICAgIHkgPSBlbGVtZW50LnkgPyBl
bGVtZW50LnkgOiBlbGVtZW50Lm9mZnNldFRvcDsNCiAgICB3aW5kb3cuc2Nyb2xsVG8oeCwgeSk7
DQogIH0sDQoNCiAgZ2V0U3R5bGU6IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKSB7DQogICAgZWxl
bWVudCA9ICQoZWxlbWVudCk7DQogICAgdmFyIHZhbHVlID0gZWxlbWVudC5zdHlsZVtzdHlsZS5j
YW1lbGl6ZSgpXTsNCiAgICBpZiAoIXZhbHVlKSB7DQogICAgICBpZiAoZG9jdW1lbnQuZGVmYXVs
dFZpZXcgJiYgZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSkgew0KICAgICAg
ICB2YXIgY3NzID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50
LCBudWxsKTsNCiAgICAgICAgdmFsdWUgPSBjc3MgPyBjc3MuZ2V0UHJvcGVydHlWYWx1ZShzdHls
ZSkgOiBudWxsOw0KICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmN1cnJlbnRTdHlsZSkgew0KICAg
ICAgICB2YWx1ZSA9IGVsZW1lbnQuY3VycmVudFN0eWxlW3N0eWxlLmNhbWVsaXplKCldOw0KICAg
ICAgfQ0KICAgIH0NCg0KICAgIGlmICh3aW5kb3cub3BlcmEgJiYgWydsZWZ0JywgJ3RvcCcsICdy
aWdodCcsICdib3R0b20nXS5pbmNsdWRlKHN0eWxlKSkNCiAgICAgIGlmIChFbGVtZW50LmdldFN0
eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09ICdzdGF0aWMnKSB2YWx1ZSA9ICdhdXRvJzsNCg0K
ICAgIHJldHVybiB2YWx1ZSA9PSAnYXV0bycgPyBudWxsIDogdmFsdWU7DQogIH0sDQoNCiAgc2V0
U3R5bGU6IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKSB7DQogICAgZWxlbWVudCA9ICQoZWxlbWVu
dCk7DQogICAgZm9yIChuYW1lIGluIHN0eWxlKQ0KICAgICAgZWxlbWVudC5zdHlsZVtuYW1lLmNh
bWVsaXplKCldID0gc3R5bGVbbmFtZV07DQogIH0sDQoNCiAgZ2V0RGltZW5zaW9uczogZnVuY3Rp
b24oZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KICAgIGlmIChFbGVtZW50
LmdldFN0eWxlKGVsZW1lbnQsICdkaXNwbGF5JykgIT0gJ25vbmUnKQ0KICAgICAgcmV0dXJuIHt3
aWR0aDogZWxlbWVudC5vZmZzZXRXaWR0aCwgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodH07
DQoNCiAgICAvLyBBbGwgKldpZHRoIGFuZCAqSGVpZ2h0IHByb3BlcnRpZXMgZ2l2ZSAwIG9uIGVs
ZW1lbnRzIHdpdGggZGlzcGxheSBub25lLA0KICAgIC8vIHNvIGVuYWJsZSB0aGUgZWxlbWVudCB0
ZW1wb3JhcmlseQ0KICAgIHZhciBlbHMgPSBlbGVtZW50LnN0eWxlOw0KICAgIHZhciBvcmlnaW5h
bFZpc2liaWxpdHkgPSBlbHMudmlzaWJpbGl0eTsNCiAgICB2YXIgb3JpZ2luYWxQb3NpdGlvbiA9
IGVscy5wb3NpdGlvbjsNCiAgICBlbHMudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KICAgIGVscy5w
b3NpdGlvbiA9ICdhYnNvbHV0ZSc7DQogICAgZWxzLmRpc3BsYXkgPSAnJzsNCiAgICB2YXIgb3Jp
Z2luYWxXaWR0aCA9IGVsZW1lbnQuY2xpZW50V2lkdGg7DQogICAgdmFyIG9yaWdpbmFsSGVpZ2h0
ID0gZWxlbWVudC5jbGllbnRIZWlnaHQ7DQogICAgZWxzLmRpc3BsYXkgPSAnbm9uZSc7DQogICAg
ZWxzLnBvc2l0aW9uID0gb3JpZ2luYWxQb3NpdGlvbjsNCiAgICBlbHMudmlzaWJpbGl0eSA9IG9y
aWdpbmFsVmlzaWJpbGl0eTsNCiAgICByZXR1cm4ge3dpZHRoOiBvcmlnaW5hbFdpZHRoLCBoZWln
aHQ6IG9yaWdpbmFsSGVpZ2h0fTsNCiAgfSwNCg0KICBtYWtlUG9zaXRpb25lZDogZnVuY3Rpb24o
ZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KICAgIHZhciBwb3MgPSBFbGVt
ZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpOw0KICAgIGlmIChwb3MgPT0gJ3N0YXRp
YycgfHwgIXBvcykgew0KICAgICAgZWxlbWVudC5fbWFkZVBvc2l0aW9uZWQgPSB0cnVlOw0KICAg
ICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7DQogICAgICAvLyBPcGVyYSBy
ZXR1cm5zIHRoZSBvZmZzZXQgcmVsYXRpdmUgdG8gdGhlIHBvc2l0aW9uaW5nIGNvbnRleHQsIHdo
ZW4gYW4NCiAgICAgIC8vIGVsZW1lbnQgaXMgcG9zaXRpb24gcmVsYXRpdmUgYnV0IHRvcCBhbmQg
bGVmdCBoYXZlIG5vdCBiZWVuIGRlZmluZWQNCiAgICAgIGlmICh3aW5kb3cub3BlcmEpIHsNCiAg
ICAgICAgZWxlbWVudC5zdHlsZS50b3AgPSAwOw0KICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQg
PSAwOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCg0KICB1bmRvUG9zaXRpb25lZDogZnVuY3Rpb24o
ZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KICAgIGlmIChlbGVtZW50Ll9t
YWRlUG9zaXRpb25lZCkgew0KICAgICAgZWxlbWVudC5fbWFkZVBvc2l0aW9uZWQgPSB1bmRlZmlu
ZWQ7DQogICAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0NCiAgICAgICAgZWxlbWVudC5zdHls
ZS50b3AgPQ0KICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPQ0KICAgICAgICBlbGVtZW50LnN0
eWxlLmJvdHRvbSA9DQogICAgICAgIGVsZW1lbnQuc3R5bGUucmlnaHQgPSAnJzsNCiAgICB9DQog
IH0sDQoNCiAgbWFrZUNsaXBwaW5nOiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxlbWVudCA9
ICQoZWxlbWVudCk7DQogICAgaWYgKGVsZW1lbnQuX292ZXJmbG93KSByZXR1cm47DQogICAgZWxl
bWVudC5fb3ZlcmZsb3cgPSBlbGVtZW50LnN0eWxlLm92ZXJmbG93Ow0KICAgIGlmICgoRWxlbWVu
dC5nZXRTdHlsZShlbGVtZW50LCAnb3ZlcmZsb3cnKSB8fCAndmlzaWJsZScpICE9ICdoaWRkZW4n
KQ0KICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOw0KICB9LA0KDQogIHVu
ZG9DbGlwcGluZzogZnVuY3Rpb24oZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQp
Ow0KICAgIGlmIChlbGVtZW50Ll9vdmVyZmxvdykgcmV0dXJuOw0KICAgIGVsZW1lbnQuc3R5bGUu
b3ZlcmZsb3cgPSBlbGVtZW50Ll9vdmVyZmxvdzsNCiAgICBlbGVtZW50Ll9vdmVyZmxvdyA9IHVu
ZGVmaW5lZDsNCiAgfQ0KfSk7DQoNCnZhciBUb2dnbGUgPSBuZXcgT2JqZWN0KCk7DQpUb2dnbGUu
ZGlzcGxheSA9IEVsZW1lbnQudG9nZ2xlOw0KDQovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KQWJz
dHJhY3QuSW5zZXJ0aW9uID0gZnVuY3Rpb24oYWRqYWNlbmN5KSB7DQogIHRoaXMuYWRqYWNlbmN5
ID0gYWRqYWNlbmN5Ow0KfQ0KDQpBYnN0cmFjdC5JbnNlcnRpb24ucHJvdG90eXBlID0gew0KICBp
bml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50KSB7DQogICAgdGhpcy5lbGVtZW50
ID0gJChlbGVtZW50KTsNCiAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50LnN0cmlwU2NyaXB0cygp
Ow0KDQogICAgaWYgKHRoaXMuYWRqYWNlbmN5ICYmIHRoaXMuZWxlbWVudC5pbnNlcnRBZGphY2Vu
dEhUTUwpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5pbnNlcnRBZGphY2Vu
dEhUTUwodGhpcy5hZGphY2VuY3ksIHRoaXMuY29udGVudCk7DQogICAgICB9IGNhdGNoIChlKSB7
DQogICAgICAgIHZhciB0YWdOYW1lID0gdGhpcy5lbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2Uo
KTsNCiAJICAgIGlmICh0YWdOYW1lID09ICd0Ym9keScgfHwgdGFnTmFtZSA9PSAndHInKSB7DQog
ICAgICAgICAgICB0aGlzLmluc2VydENvbnRlbnQodGhpcy5jb250ZW50RnJvbUFub255bW91c1Rh
YmxlKCkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRocm93IGU7DQogICAgICAgIH0N
CiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5yYW5nZSA9IHRoaXMuZWxlbWVudC5v
d25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7DQogICAgICBpZiAodGhpcy5pbml0aWFsaXplUmFu
Z2UpIHRoaXMuaW5pdGlhbGl6ZVJhbmdlKCk7DQogICAgICB0aGlzLmluc2VydENvbnRlbnQoW3Ro
aXMucmFuZ2UuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KHRoaXMuY29udGVudCldKTsNCiAgICB9
DQoNCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2NvbnRlbnQuZXZhbFNjcmlwdHMoKX0sIDEw
KTsNCiAgfSwNCg0KICBjb250ZW50RnJvbUFub255bW91c1RhYmxlOiBmdW5jdGlvbigpIHsNCiAg
ICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZGl2LmlubmVy
SFRNTCA9ICc8dGFibGU+PHRib2R5PicgKyB0aGlzLmNvbnRlbnQgKyAnPC90Ym9keT48L3RhYmxl
Pic7DQogICAgcmV0dXJuICRBKGRpdi5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGRO
b2Rlcyk7DQogIH0NCn0NCg0KdmFyIEluc2VydGlvbiA9IG5ldyBPYmplY3QoKTsNCg0KSW5zZXJ0
aW9uLkJlZm9yZSA9IENsYXNzLmNyZWF0ZSgpOw0KSW5zZXJ0aW9uLkJlZm9yZS5wcm90b3R5cGUg
PSBPYmplY3QuZXh0ZW5kKG5ldyBBYnN0cmFjdC5JbnNlcnRpb24oJ2JlZm9yZUJlZ2luJyksIHsN
CiAgaW5pdGlhbGl6ZVJhbmdlOiBmdW5jdGlvbigpIHsNCiAgICB0aGlzLnJhbmdlLnNldFN0YXJ0
QmVmb3JlKHRoaXMuZWxlbWVudCk7DQogIH0sDQoNCiAgaW5zZXJ0Q29udGVudDogZnVuY3Rpb24o
ZnJhZ21lbnRzKSB7DQogICAgZnJhZ21lbnRzLmVhY2goKGZ1bmN0aW9uKGZyYWdtZW50KSB7DQog
ICAgICB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsIHRoaXMu
ZWxlbWVudCk7DQogICAgfSkuYmluZCh0aGlzKSk7DQogIH0NCn0pOw0KDQpJbnNlcnRpb24uVG9w
ID0gQ2xhc3MuY3JlYXRlKCk7DQpJbnNlcnRpb24uVG9wLnByb3RvdHlwZSA9IE9iamVjdC5leHRl
bmQobmV3IEFic3RyYWN0Lkluc2VydGlvbignYWZ0ZXJCZWdpbicpLCB7DQogIGluaXRpYWxpemVS
YW5nZTogZnVuY3Rpb24oKSB7DQogICAgdGhpcy5yYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGhp
cy5lbGVtZW50KTsNCiAgICB0aGlzLnJhbmdlLmNvbGxhcHNlKHRydWUpOw0KICB9LA0KDQogIGlu
c2VydENvbnRlbnQ6IGZ1bmN0aW9uKGZyYWdtZW50cykgew0KICAgIGZyYWdtZW50cy5yZXZlcnNl
KGZhbHNlKS5lYWNoKChmdW5jdGlvbihmcmFnbWVudCkgew0KICAgICAgdGhpcy5lbGVtZW50Lmlu
c2VydEJlZm9yZShmcmFnbWVudCwgdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpOw0KICAgIH0pLmJp
bmQodGhpcykpOw0KICB9DQp9KTsNCg0KSW5zZXJ0aW9uLkJvdHRvbSA9IENsYXNzLmNyZWF0ZSgp
Ow0KSW5zZXJ0aW9uLkJvdHRvbS5wcm90b3R5cGUgPSBPYmplY3QuZXh0ZW5kKG5ldyBBYnN0cmFj
dC5JbnNlcnRpb24oJ2JlZm9yZUVuZCcpLCB7DQogIGluaXRpYWxpemVSYW5nZTogZnVuY3Rpb24o
KSB7DQogICAgdGhpcy5yYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGhpcy5lbGVtZW50KTsNCiAg
ICB0aGlzLnJhbmdlLmNvbGxhcHNlKHRoaXMuZWxlbWVudCk7DQogIH0sDQoNCiAgaW5zZXJ0Q29u
dGVudDogZnVuY3Rpb24oZnJhZ21lbnRzKSB7DQogICAgZnJhZ21lbnRzLmVhY2goKGZ1bmN0aW9u
KGZyYWdtZW50KSB7DQogICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpOw0K
ICAgIH0pLmJpbmQodGhpcykpOw0KICB9DQp9KTsNCg0KSW5zZXJ0aW9uLkFmdGVyID0gQ2xhc3Mu
Y3JlYXRlKCk7DQpJbnNlcnRpb24uQWZ0ZXIucHJvdG90eXBlID0gT2JqZWN0LmV4dGVuZChuZXcg
QWJzdHJhY3QuSW5zZXJ0aW9uKCdhZnRlckVuZCcpLCB7DQogIGluaXRpYWxpemVSYW5nZTogZnVu
Y3Rpb24oKSB7DQogICAgdGhpcy5yYW5nZS5zZXRTdGFydEFmdGVyKHRoaXMuZWxlbWVudCk7DQog
IH0sDQoNCiAgaW5zZXJ0Q29udGVudDogZnVuY3Rpb24oZnJhZ21lbnRzKSB7DQogICAgZnJhZ21l
bnRzLmVhY2goKGZ1bmN0aW9uKGZyYWdtZW50KSB7DQogICAgICB0aGlzLmVsZW1lbnQucGFyZW50
Tm9kZS5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsDQogICAgICAgIHRoaXMuZWxlbWVudC5uZXh0U2li
bGluZyk7DQogICAgfSkuYmluZCh0aGlzKSk7DQogIH0NCn0pOw0KDQovKi0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tKi8NCg0KRWxlbWVudC5DbGFzc05hbWVzID0gQ2xhc3MuY3JlYXRlKCk7DQpFbGVtZW50LkNs
YXNzTmFtZXMucHJvdG90eXBlID0gew0KICBpbml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50KSB7
DQogICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTsNCiAgfSwNCg0KICBfZWFjaDogZnVuY3Rp
b24oaXRlcmF0b3IpIHsNCiAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9ccysvKS5z
ZWxlY3QoZnVuY3Rpb24obmFtZSkgew0KICAgICAgcmV0dXJuIG5hbWUubGVuZ3RoID4gMDsNCiAg
ICB9KS5fZWFjaChpdGVyYXRvcik7DQogIH0sDQoNCiAgc2V0OiBmdW5jdGlvbihjbGFzc05hbWUp
IHsNCiAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NOYW1lOw0KICB9LA0KDQogIGFk
ZDogZnVuY3Rpb24oY2xhc3NOYW1lVG9BZGQpIHsNCiAgICBpZiAodGhpcy5pbmNsdWRlKGNsYXNz
TmFtZVRvQWRkKSkgcmV0dXJuOw0KICAgIHRoaXMuc2V0KHRoaXMudG9BcnJheSgpLmNvbmNhdChj
bGFzc05hbWVUb0FkZCkuam9pbignICcpKTsNCiAgfSwNCg0KICByZW1vdmU6IGZ1bmN0aW9uKGNs
YXNzTmFtZVRvUmVtb3ZlKSB7DQogICAgaWYgKCF0aGlzLmluY2x1ZGUoY2xhc3NOYW1lVG9SZW1v
dmUpKSByZXR1cm47DQogICAgdGhpcy5zZXQodGhpcy5zZWxlY3QoZnVuY3Rpb24oY2xhc3NOYW1l
KSB7DQogICAgICByZXR1cm4gY2xhc3NOYW1lICE9IGNsYXNzTmFtZVRvUmVtb3ZlOw0KICAgIH0p
LmpvaW4oJyAnKSk7DQogIH0sDQoNCiAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVy
biB0aGlzLnRvQXJyYXkoKS5qb2luKCcgJyk7DQogIH0NCn0NCg0KT2JqZWN0LmV4dGVuZChFbGVt
ZW50LkNsYXNzTmFtZXMucHJvdG90eXBlLCBFbnVtZXJhYmxlKTsNCnZhciBGaWVsZCA9IHsNCiAg
Y2xlYXI6IGZ1bmN0aW9uKCkgew0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxl
bmd0aDsgaSsrKQ0KICAgICAgJChhcmd1bWVudHNbaV0pLnZhbHVlID0gJyc7DQogIH0sDQoNCiAg
Zm9jdXM6IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCiAgICAkKGVsZW1lbnQpLmZvY3VzKCk7DQogIH0s
DQoNCiAgcHJlc2VudDogZnVuY3Rpb24oKSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1
bWVudHMubGVuZ3RoOyBpKyspDQogICAgICBpZiAoJChhcmd1bWVudHNbaV0pLnZhbHVlID09ICcn
KSByZXR1cm4gZmFsc2U7DQogICAgcmV0dXJuIHRydWU7DQogIH0sDQoNCiAgc2VsZWN0OiBmdW5j
dGlvbihlbGVtZW50KSB7DQogICAgJChlbGVtZW50KS5zZWxlY3QoKTsNCiAgfSwNCg0KICBhY3Rp
dmF0ZTogZnVuY3Rpb24oZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KICAg
IGVsZW1lbnQuZm9jdXMoKTsNCiAgICBpZiAoZWxlbWVudC5zZWxlY3QpDQogICAgICBlbGVtZW50
LnNlbGVjdCgpOw0KICB9DQp9DQoNCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQp2YXIgRm9ybSA9
IHsNCiAgc2VyaWFsaXplOiBmdW5jdGlvbihmb3JtKSB7DQogICAgdmFyIGVsZW1lbnRzID0gRm9y
bS5nZXRFbGVtZW50cygkKGZvcm0pKTsNCiAgICB2YXIgcXVlcnlDb21wb25lbnRzID0gbmV3IEFy
cmF5KCk7DQoNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7
DQogICAgICB2YXIgcXVlcnlDb21wb25lbnQgPSBGb3JtLkVsZW1lbnQuc2VyaWFsaXplKGVsZW1l
bnRzW2ldKTsNCiAgICAgIGlmIChxdWVyeUNvbXBvbmVudCkNCiAgICAgICAgcXVlcnlDb21wb25l
bnRzLnB1c2gocXVlcnlDb21wb25lbnQpOw0KICAgIH0NCg0KICAgIHJldHVybiBxdWVyeUNvbXBv
bmVudHMuam9pbignJicpOw0KICB9LA0KDQogIGdldEVsZW1lbnRzOiBmdW5jdGlvbihmb3JtKSB7
DQogICAgZm9ybSA9ICQoZm9ybSk7DQogICAgdmFyIGVsZW1lbnRzID0gbmV3IEFycmF5KCk7DQoN
CiAgICBmb3IgKHRhZ05hbWUgaW4gRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzKSB7DQogICAgICB2
YXIgdGFnRWxlbWVudHMgPSBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUpOw0KICAg
ICAgZm9yICh2YXIgaiA9IDA7IGogPCB0YWdFbGVtZW50cy5sZW5ndGg7IGorKykNCiAgICAgICAg
ZWxlbWVudHMucHVzaCh0YWdFbGVtZW50c1tqXSk7DQogICAgfQ0KICAgIHJldHVybiBlbGVtZW50
czsNCiAgfSwNCg0KICBnZXRJbnB1dHM6IGZ1bmN0aW9uKGZvcm0sIHR5cGVOYW1lLCBuYW1lKSB7
DQogICAgZm9ybSA9ICQoZm9ybSk7DQogICAgdmFyIGlucHV0cyA9IGZvcm0uZ2V0RWxlbWVudHNC
eVRhZ05hbWUoJ2lucHV0Jyk7DQoNCiAgICBpZiAoIXR5cGVOYW1lICYmICFuYW1lKQ0KICAgICAg
cmV0dXJuIGlucHV0czsNCg0KICAgIHZhciBtYXRjaGluZ0lucHV0cyA9IG5ldyBBcnJheSgpOw0K
ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIg
aW5wdXQgPSBpbnB1dHNbaV07DQogICAgICBpZiAoKHR5cGVOYW1lICYmIGlucHV0LnR5cGUgIT0g
dHlwZU5hbWUpIHx8DQogICAgICAgICAgKG5hbWUgJiYgaW5wdXQubmFtZSAhPSBuYW1lKSkNCiAg
ICAgICAgY29udGludWU7DQogICAgICBtYXRjaGluZ0lucHV0cy5wdXNoKGlucHV0KTsNCiAgICB9
DQoNCiAgICByZXR1cm4gbWF0Y2hpbmdJbnB1dHM7DQogIH0sDQoNCiAgZGlzYWJsZTogZnVuY3Rp
b24oZm9ybSkgew0KICAgIHZhciBlbGVtZW50cyA9IEZvcm0uZ2V0RWxlbWVudHMoZm9ybSk7DQog
ICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFy
IGVsZW1lbnQgPSBlbGVtZW50c1tpXTsNCiAgICAgIGVsZW1lbnQuYmx1cigpOw0KICAgICAgZWxl
bWVudC5kaXNhYmxlZCA9ICd0cnVlJzsNCiAgICB9DQogIH0sDQoNCiAgZW5hYmxlOiBmdW5jdGlv
bihmb3JtKSB7DQogICAgdmFyIGVsZW1lbnRzID0gRm9ybS5nZXRFbGVtZW50cyhmb3JtKTsNCiAg
ICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIg
ZWxlbWVudCA9IGVsZW1lbnRzW2ldOw0KICAgICAgZWxlbWVudC5kaXNhYmxlZCA9ICcnOw0KICAg
IH0NCiAgfSwNCg0KICBmaW5kRmlyc3RFbGVtZW50OiBmdW5jdGlvbihmb3JtKSB7DQogICAgcmV0
dXJuIEZvcm0uZ2V0RWxlbWVudHMoZm9ybSkuZmluZChmdW5jdGlvbihlbGVtZW50KSB7DQogICAg
ICByZXR1cm4gZWxlbWVudC50eXBlICE9ICdoaWRkZW4nICYmICFlbGVtZW50LmRpc2FibGVkICYm
DQogICAgICAgIFsnaW5wdXQnLCAnc2VsZWN0JywgJ3RleHRhcmVhJ10uaW5jbHVkZShlbGVtZW50
LnRhZ05hbWUudG9Mb3dlckNhc2UoKSk7DQogICAgfSk7DQogIH0sDQoNCiAgZm9jdXNGaXJzdEVs
ZW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHsNCiAgICBGaWVsZC5hY3RpdmF0ZShGb3JtLmZpbmRGaXJz
dEVsZW1lbnQoZm9ybSkpOw0KICB9LA0KDQogIHJlc2V0OiBmdW5jdGlvbihmb3JtKSB7DQogICAg
JChmb3JtKS5yZXNldCgpOw0KICB9DQp9DQoNCkZvcm0uRWxlbWVudCA9IHsNCiAgc2VyaWFsaXpl
OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7DQogICAgdmFy
IG1ldGhvZCA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOw0KICAgIHZhciBwYXJhbWV0
ZXIgPSBGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnNbbWV0aG9kXShlbGVtZW50KTsNCg0KICAgIGlm
IChwYXJhbWV0ZXIpIHsNCiAgICAgIHZhciBrZXkgPSBlbmNvZGVVUklDb21wb25lbnQocGFyYW1l
dGVyWzBdKTsNCiAgICAgIGlmIChrZXkubGVuZ3RoID09IDApIHJldHVybjsNCg0KICAgICAgaWYg
KHBhcmFtZXRlclsxXS5jb25zdHJ1Y3RvciAhPSBBcnJheSkNCiAgICAgICAgcGFyYW1ldGVyWzFd
ID0gW3BhcmFtZXRlclsxXV07DQoNCiAgICAgIHJldHVybiBwYXJhbWV0ZXJbMV0ubWFwKGZ1bmN0
aW9uKHZhbHVlKSB7DQogICAgICAgIHJldHVybiBrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25l
bnQodmFsdWUpOw0KICAgICAgfSkuam9pbignJicpOw0KICAgIH0NCiAgfSwNCg0KICBnZXRWYWx1
ZTogZnVuY3Rpb24oZWxlbWVudCkgew0KICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOw0KICAgIHZh
ciBtZXRob2QgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsNCiAgICB2YXIgcGFyYW1l
dGVyID0gRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzW21ldGhvZF0oZWxlbWVudCk7DQoNCiAgICBp
ZiAocGFyYW1ldGVyKQ0KICAgICAgcmV0dXJuIHBhcmFtZXRlclsxXTsNCiAgfQ0KfQ0KDQpGb3Jt
LkVsZW1lbnQuU2VyaWFsaXplcnMgPSB7DQogIGlucHV0OiBmdW5jdGlvbihlbGVtZW50KSB7DQog
ICAgc3dpdGNoIChlbGVtZW50LnR5cGUudG9Mb3dlckNhc2UoKSkgew0KICAgICAgY2FzZSAnc3Vi
bWl0JzoNCiAgICAgIGNhc2UgJ2hpZGRlbic6DQogICAgICBjYXNlICdwYXNzd29yZCc6DQogICAg
ICBjYXNlICd0ZXh0JzoNCiAgICAgICAgcmV0dXJuIEZvcm0uRWxlbWVudC5TZXJpYWxpemVycy50
ZXh0YXJlYShlbGVtZW50KTsNCiAgICAgIGNhc2UgJ2NoZWNrYm94JzoNCiAgICAgIGNhc2UgJ3Jh
ZGlvJzoNCiAgICAgICAgcmV0dXJuIEZvcm0uRWxlbWVudC5TZXJpYWxpemVycy5pbnB1dFNlbGVj
dG9yKGVsZW1lbnQpOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0sDQoNCiAgaW5wdXRT
ZWxlY3RvcjogZnVuY3Rpb24oZWxlbWVudCkgew0KICAgIGlmIChlbGVtZW50LmNoZWNrZWQpDQog
ICAgICByZXR1cm4gW2VsZW1lbnQubmFtZSwgZWxlbWVudC52YWx1ZV07DQogIH0sDQoNCiAgdGV4
dGFyZWE6IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCiAgICByZXR1cm4gW2VsZW1lbnQubmFtZSwgZWxl
bWVudC52YWx1ZV07DQogIH0sDQoNCiAgc2VsZWN0OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAg
cmV0dXJuIEZvcm0uRWxlbWVudC5TZXJpYWxpemVyc1tlbGVtZW50LnR5cGUgPT0gJ3NlbGVjdC1v
bmUnID8NCiAgICAgICdzZWxlY3RPbmUnIDogJ3NlbGVjdE1hbnknXShlbGVtZW50KTsNCiAgfSwN
Cg0KICBzZWxlY3RPbmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCiAgICB2YXIgdmFsdWUgPSAnJywg
b3B0LCBpbmRleCA9IGVsZW1lbnQuc2VsZWN0ZWRJbmRleDsNCiAgICBpZiAoaW5kZXggPj0gMCkg
ew0KICAgICAgb3B0ID0gZWxlbWVudC5vcHRpb25zW2luZGV4XTsNCiAgICAgIHZhbHVlID0gb3B0
LnZhbHVlOw0KICAgICAgaWYgKCF2YWx1ZSAmJiAhKCd2YWx1ZScgaW4gb3B0KSkNCiAgICAgICAg
dmFsdWUgPSBvcHQudGV4dDsNCiAgICB9DQogICAgcmV0dXJuIFtlbGVtZW50Lm5hbWUsIHZhbHVl
XTsNCiAgfSwNCg0KICBzZWxlY3RNYW55OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgdmFyIHZh
bHVlID0gbmV3IEFycmF5KCk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50Lmxlbmd0
aDsgaSsrKSB7DQogICAgICB2YXIgb3B0ID0gZWxlbWVudC5vcHRpb25zW2ldOw0KICAgICAgaWYg
KG9wdC5zZWxlY3RlZCkgew0KICAgICAgICB2YXIgb3B0VmFsdWUgPSBvcHQudmFsdWU7DQogICAg
ICAgIGlmICghb3B0VmFsdWUgJiYgISgndmFsdWUnIGluIG9wdCkpDQogICAgICAgICAgb3B0VmFs
dWUgPSBvcHQudGV4dDsNCiAgICAgICAgdmFsdWUucHVzaChvcHRWYWx1ZSk7DQogICAgICB9DQog
ICAgfQ0KICAgIHJldHVybiBbZWxlbWVudC5uYW1lLCB2YWx1ZV07DQogIH0NCn0NCg0KLyotLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLSovDQoNCnZhciAkRiA9IEZvcm0uRWxlbWVudC5nZXRWYWx1ZTsNCg0KLyot
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLSovDQoNCkFic3RyYWN0LlRpbWVkT2JzZXJ2ZXIgPSBmdW5jdGlvbigp
IHt9DQpBYnN0cmFjdC5UaW1lZE9ic2VydmVyLnByb3RvdHlwZSA9IHsNCiAgaW5pdGlhbGl6ZTog
ZnVuY3Rpb24oZWxlbWVudCwgZnJlcXVlbmN5LCBjYWxsYmFjaykgew0KICAgIHRoaXMuZnJlcXVl
bmN5ID0gZnJlcXVlbmN5Ow0KICAgIHRoaXMuZWxlbWVudCAgID0gJChlbGVtZW50KTsNCiAgICB0
aGlzLmNhbGxiYWNrICA9IGNhbGxiYWNrOw0KDQogICAgdGhpcy5sYXN0VmFsdWUgPSB0aGlzLmdl
dFZhbHVlKCk7DQogICAgdGhpcy5yZWdpc3RlckNhbGxiYWNrKCk7DQogIH0sDQoNCiAgcmVnaXN0
ZXJDYWxsYmFjazogZnVuY3Rpb24oKSB7DQogICAgc2V0SW50ZXJ2YWwodGhpcy5vblRpbWVyRXZl
bnQuYmluZCh0aGlzKSwgdGhpcy5mcmVxdWVuY3kgKiAxMDAwKTsNCiAgfSwNCg0KICBvblRpbWVy
RXZlbnQ6IGZ1bmN0aW9uKCkgew0KICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTsNCiAg
ICBpZiAodGhpcy5sYXN0VmFsdWUgIT0gdmFsdWUpIHsNCiAgICAgIHRoaXMuY2FsbGJhY2sodGhp
cy5lbGVtZW50LCB2YWx1ZSk7DQogICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlOw0KICAgIH0N
CiAgfQ0KfQ0KDQpGb3JtLkVsZW1lbnQuT2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoKTsNCkZvcm0u
RWxlbWVudC5PYnNlcnZlci5wcm90b3R5cGUgPSBPYmplY3QuZXh0ZW5kKG5ldyBBYnN0cmFjdC5U
aW1lZE9ic2VydmVyKCksIHsNCiAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBG
b3JtLkVsZW1lbnQuZ2V0VmFsdWUodGhpcy5lbGVtZW50KTsNCiAgfQ0KfSk7DQoNCkZvcm0uT2Jz
ZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoKTsNCkZvcm0uT2JzZXJ2ZXIucHJvdG90eXBlID0gT2JqZWN0
LmV4dGVuZChuZXcgQWJzdHJhY3QuVGltZWRPYnNlcnZlcigpLCB7DQogIGdldFZhbHVlOiBmdW5j
dGlvbigpIHsNCiAgICByZXR1cm4gRm9ybS5zZXJpYWxpemUodGhpcy5lbGVtZW50KTsNCiAgfQ0K
fSk7DQoNCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpBYnN0cmFjdC5FdmVudE9ic2VydmVyID0g
ZnVuY3Rpb24oKSB7fQ0KQWJzdHJhY3QuRXZlbnRPYnNlcnZlci5wcm90b3R5cGUgPSB7DQogIGlu
aXRpYWxpemU6IGZ1bmN0aW9uKGVsZW1lbnQsIGNhbGxiYWNrKSB7DQogICAgdGhpcy5lbGVtZW50
ICA9ICQoZWxlbWVudCk7DQogICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOw0KDQogICAgdGhp
cy5sYXN0VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7DQogICAgaWYgKHRoaXMuZWxlbWVudC50YWdO
YW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2Zvcm0nKQ0KICAgICAgdGhpcy5yZWdpc3RlckZvcm1DYWxs
YmFja3MoKTsNCiAgICBlbHNlDQogICAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2sodGhpcy5lbGVt
ZW50KTsNCiAgfSwNCg0KICBvbkVsZW1lbnRFdmVudDogZnVuY3Rpb24oKSB7DQogICAgdmFyIHZh
bHVlID0gdGhpcy5nZXRWYWx1ZSgpOw0KICAgIGlmICh0aGlzLmxhc3RWYWx1ZSAhPSB2YWx1ZSkg
ew0KICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLmVsZW1lbnQsIHZhbHVlKTsNCiAgICAgIHRoaXMu
bGFzdFZhbHVlID0gdmFsdWU7DQogICAgfQ0KICB9LA0KDQogIHJlZ2lzdGVyRm9ybUNhbGxiYWNr
czogZnVuY3Rpb24oKSB7DQogICAgdmFyIGVsZW1lbnRzID0gRm9ybS5nZXRFbGVtZW50cyh0aGlz
LmVsZW1lbnQpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKysp
DQogICAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2soZWxlbWVudHNbaV0pOw0KICB9LA0KDQogIHJl
Z2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCiAgICBpZiAoZWxlbWVudC50eXBl
KSB7DQogICAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZS50b0xvd2VyQ2FzZSgpKSB7DQogICAgICAg
IGNhc2UgJ2NoZWNrYm94JzoNCiAgICAgICAgY2FzZSAncmFkaW8nOg0KICAgICAgICAgIEV2ZW50
Lm9ic2VydmUoZWxlbWVudCwgJ2NsaWNrJywgdGhpcy5vbkVsZW1lbnRFdmVudC5iaW5kKHRoaXMp
KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAncGFzc3dvcmQnOg0KICAgICAgICBj
YXNlICd0ZXh0JzoNCiAgICAgICAgY2FzZSAndGV4dGFyZWEnOg0KICAgICAgICBjYXNlICdzZWxl
Y3Qtb25lJzoNCiAgICAgICAgY2FzZSAnc2VsZWN0LW11bHRpcGxlJzoNCiAgICAgICAgICBFdmVu
dC5vYnNlcnZlKGVsZW1lbnQsICdjaGFuZ2UnLCB0aGlzLm9uRWxlbWVudEV2ZW50LmJpbmQodGhp
cykpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0KDQpGb3JtLkVs
ZW1lbnQuRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZSgpOw0KRm9ybS5FbGVtZW50LkV2ZW50
T2JzZXJ2ZXIucHJvdG90eXBlID0gT2JqZWN0LmV4dGVuZChuZXcgQWJzdHJhY3QuRXZlbnRPYnNl
cnZlcigpLCB7DQogIGdldFZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4gRm9ybS5FbGVt
ZW50LmdldFZhbHVlKHRoaXMuZWxlbWVudCk7DQogIH0NCn0pOw0KDQpGb3JtLkV2ZW50T2JzZXJ2
ZXIgPSBDbGFzcy5jcmVhdGUoKTsNCkZvcm0uRXZlbnRPYnNlcnZlci5wcm90b3R5cGUgPSBPYmpl
Y3QuZXh0ZW5kKG5ldyBBYnN0cmFjdC5FdmVudE9ic2VydmVyKCksIHsNCiAgZ2V0VmFsdWU6IGZ1
bmN0aW9uKCkgew0KICAgIHJldHVybiBGb3JtLnNlcmlhbGl6ZSh0aGlzLmVsZW1lbnQpOw0KICB9
DQp9KTsNCmlmICghd2luZG93LkV2ZW50KSB7DQogIHZhciBFdmVudCA9IG5ldyBPYmplY3QoKTsN
Cn0NCg0KT2JqZWN0LmV4dGVuZChFdmVudCwgew0KICBLRVlfQkFDS1NQQUNFOiA4LA0KICBLRVlf
VEFCOiAgICAgICA5LA0KICBLRVlfUkVUVVJOOiAgIDEzLA0KICBLRVlfRVNDOiAgICAgIDI3LA0K
ICBLRVlfTEVGVDogICAgIDM3LA0KICBLRVlfVVA6ICAgICAgIDM4LA0KICBLRVlfUklHSFQ6ICAg
IDM5LA0KICBLRVlfRE9XTjogICAgIDQwLA0KICBLRVlfREVMRVRFOiAgIDQ2LA0KDQogIGVsZW1l
bnQ6IGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgcmV0dXJuIGV2ZW50LnRhcmdldCB8fCBldmVudC5z
cmNFbGVtZW50Ow0KICB9LA0KDQogIGlzTGVmdENsaWNrOiBmdW5jdGlvbihldmVudCkgew0KICAg
IHJldHVybiAoKChldmVudC53aGljaCkgJiYgKGV2ZW50LndoaWNoID09IDEpKSB8fA0KICAgICAg
ICAgICAgKChldmVudC5idXR0b24pICYmIChldmVudC5idXR0b24gPT0gMSkpKTsNCiAgfSwNCg0K
ICBwb2ludGVyWDogZnVuY3Rpb24oZXZlbnQpIHsNCiAgICByZXR1cm4gZXZlbnQucGFnZVggfHwg
KGV2ZW50LmNsaWVudFggKw0KICAgICAgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxM
ZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCkpOw0KICB9LA0KDQogIHBvaW50ZXJZOiBm
dW5jdGlvbihldmVudCkgew0KICAgIHJldHVybiBldmVudC5wYWdlWSB8fCAoZXZlbnQuY2xpZW50
WSArDQogICAgICAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVu
dC5ib2R5LnNjcm9sbFRvcCkpOw0KICB9LA0KDQogIHN0b3A6IGZ1bmN0aW9uKGV2ZW50KSB7DQog
ICAgaWYgKGV2ZW50LnByZXZlbnREZWZhdWx0KSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVs
dCgpOw0KICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgfSBlbHNlIHsNCiAgICAg
IGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7DQogICAgICBldmVudC5jYW5jZWxCdWJibGUgPSB0
cnVlOw0KICAgIH0NCiAgfSwNCg0KICAvLyBmaW5kIHRoZSBmaXJzdCBub2RlIHdpdGggdGhlIGdp
dmVuIHRhZ05hbWUsIHN0YXJ0aW5nIGZyb20gdGhlDQogIC8vIG5vZGUgdGhlIGV2ZW50IHdhcyB0
cmlnZ2VyZWQgb247IHRyYXZlcnNlcyB0aGUgRE9NIHVwd2FyZHMNCiAgZmluZEVsZW1lbnQ6IGZ1
bmN0aW9uKGV2ZW50LCB0YWdOYW1lKSB7DQogICAgdmFyIGVsZW1lbnQgPSBFdmVudC5lbGVtZW50
KGV2ZW50KTsNCiAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnROb2RlICYmICghZWxlbWVudC50YWdO
YW1lIHx8DQogICAgICAgIChlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSAhPSB0YWdOYW1l
LnRvVXBwZXJDYXNlKCkpKSkNCiAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7DQog
ICAgcmV0dXJuIGVsZW1lbnQ7DQogIH0sDQoNCiAgb2JzZXJ2ZXJzOiBmYWxzZSwNCg0KICBfb2Jz
ZXJ2ZUFuZENhY2hlOiBmdW5jdGlvbihlbGVtZW50LCBuYW1lLCBvYnNlcnZlciwgdXNlQ2FwdHVy
ZSkgew0KICAgIGlmICghdGhpcy5vYnNlcnZlcnMpIHRoaXMub2JzZXJ2ZXJzID0gW107DQogICAg
aWYgKGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgew0KICAgICAgdGhpcy5vYnNlcnZlcnMucHVz
aChbZWxlbWVudCwgbmFtZSwgb2JzZXJ2ZXIsIHVzZUNhcHR1cmVdKTsNCiAgICAgIGVsZW1lbnQu
YWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBvYnNlcnZlciwgdXNlQ2FwdHVyZSk7DQogICAgfSBlbHNl
IGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7DQogICAgICB0aGlzLm9ic2VydmVycy5wdXNoKFtl
bGVtZW50LCBuYW1lLCBvYnNlcnZlciwgdXNlQ2FwdHVyZV0pOw0KICAgICAgZWxlbWVudC5hdHRh
Y2hFdmVudCgnb24nICsgbmFtZSwgb2JzZXJ2ZXIpOw0KICAgIH0NCiAgfSwNCg0KICB1bmxvYWRD
YWNoZTogZnVuY3Rpb24oKSB7DQogICAgaWYgKCFFdmVudC5vYnNlcnZlcnMpIHJldHVybjsNCiAg
ICBmb3IgKHZhciBpID0gMDsgaSA8IEV2ZW50Lm9ic2VydmVycy5sZW5ndGg7IGkrKykgew0KICAg
ICAgRXZlbnQuc3RvcE9ic2VydmluZy5hcHBseSh0aGlzLCBFdmVudC5vYnNlcnZlcnNbaV0pOw0K
ICAgICAgRXZlbnQub2JzZXJ2ZXJzW2ldWzBdID0gbnVsbDsNCiAgICB9DQogICAgRXZlbnQub2Jz
ZXJ2ZXJzID0gZmFsc2U7DQogIH0sDQoNCiAgb2JzZXJ2ZTogZnVuY3Rpb24oZWxlbWVudCwgbmFt
ZSwgb2JzZXJ2ZXIsIHVzZUNhcHR1cmUpIHsNCiAgICB2YXIgZWxlbWVudCA9ICQoZWxlbWVudCk7
DQogICAgdXNlQ2FwdHVyZSA9IHVzZUNhcHR1cmUgfHwgZmFsc2U7DQoNCiAgICBpZiAobmFtZSA9
PSAna2V5cHJlc3MnICYmDQogICAgICAgIChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5tYXRjaCgvS29u
cXVlcm9yfFNhZmFyaXxLSFRNTC8pDQogICAgICAgIHx8IGVsZW1lbnQuYXR0YWNoRXZlbnQpKQ0K
ICAgICAgbmFtZSA9ICdrZXlkb3duJzsNCg0KICAgIHRoaXMuX29ic2VydmVBbmRDYWNoZShlbGVt
ZW50LCBuYW1lLCBvYnNlcnZlciwgdXNlQ2FwdHVyZSk7DQogIH0sDQoNCiAgc3RvcE9ic2Vydmlu
ZzogZnVuY3Rpb24oZWxlbWVudCwgbmFtZSwgb2JzZXJ2ZXIsIHVzZUNhcHR1cmUpIHsNCiAgICB2
YXIgZWxlbWVudCA9ICQoZWxlbWVudCk7DQogICAgdXNlQ2FwdHVyZSA9IHVzZUNhcHR1cmUgfHwg
ZmFsc2U7DQoNCiAgICBpZiAobmFtZSA9PSAna2V5cHJlc3MnICYmDQogICAgICAgIChuYXZpZ2F0
b3IuYXBwVmVyc2lvbi5tYXRjaCgvS29ucXVlcm9yfFNhZmFyaXxLSFRNTC8pDQogICAgICAgIHx8
IGVsZW1lbnQuZGV0YWNoRXZlbnQpKQ0KICAgICAgbmFtZSA9ICdrZXlkb3duJzsNCg0KICAgIGlm
IChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsNCiAgICAgIGVsZW1lbnQucmVtb3ZlRXZl
bnRMaXN0ZW5lcihuYW1lLCBvYnNlcnZlciwgdXNlQ2FwdHVyZSk7DQogICAgfSBlbHNlIGlmIChl
bGVtZW50LmRldGFjaEV2ZW50KSB7DQogICAgICBlbGVtZW50LmRldGFjaEV2ZW50KCdvbicgKyBu
YW1lLCBvYnNlcnZlcik7DQogICAgfQ0KICB9DQp9KTsNCg0KLyogcHJldmVudCBtZW1vcnkgbGVh
a3MgaW4gSUUgKi8NCkV2ZW50Lm9ic2VydmUod2luZG93LCAndW5sb2FkJywgRXZlbnQudW5sb2Fk
Q2FjaGUsIGZhbHNlKTsNCnZhciBQb3NpdGlvbiA9IHsNCiAgLy8gc2V0IHRvIHRydWUgaWYgbmVl
ZGVkLCB3YXJuaW5nOiBmaXJlZm94IHBlcmZvcm1hbmNlIHByb2JsZW1zDQogIC8vIE5PVCBuZWVl
ZGVkIGZvciBwYWdlIHNjcm9sbGluZywgb25seSBpZiBkcmFnZ2FibGUgY29udGFpbmVkIGluDQog
IC8vIHNjcm9sbGFibGUgZWxlbWVudHMNCiAgaW5jbHVkZVNjcm9sbE9mZnNldHM6IGZhbHNlLA0K
DQogIC8vIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBjYWxsaW5nIHdpdGhpbkluY2x1ZGluZ1Njcm9s
bG9mZnNldCwgZXZlcnkgdGltZSB0aGUNCiAgLy8gcGFnZSBpcyBzY3JvbGxlZA0KICBwcmVwYXJl
OiBmdW5jdGlvbigpIHsNCiAgICB0aGlzLmRlbHRhWCA9ICB3aW5kb3cucGFnZVhPZmZzZXQNCiAg
ICAgICAgICAgICAgICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdA0KICAg
ICAgICAgICAgICAgIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdA0KICAgICAgICAgICAgICAg
IHx8IDA7DQogICAgdGhpcy5kZWx0YVkgPSAgd2luZG93LnBhZ2VZT2Zmc2V0DQogICAgICAgICAg
ICAgICAgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcA0KICAgICAgICAgICAg
ICAgIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wDQogICAgICAgICAgICAgICAgfHwgMDsNCiAg
fSwNCg0KICByZWFsT2Zmc2V0OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgdmFyIHZhbHVlVCA9
IDAsIHZhbHVlTCA9IDA7DQogICAgZG8gew0KICAgICAgdmFsdWVUICs9IGVsZW1lbnQuc2Nyb2xs
VG9wICB8fCAwOw0KICAgICAgdmFsdWVMICs9IGVsZW1lbnQuc2Nyb2xsTGVmdCB8fCAwOw0KICAg
ICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsNCiAgICB9IHdoaWxlIChlbGVtZW50KTsN
CiAgICByZXR1cm4gW3ZhbHVlTCwgdmFsdWVUXTsNCiAgfSwNCg0KICBjdW11bGF0aXZlT2Zmc2V0
OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7DQog
ICAgZG8gew0KICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wICB8fCAwOw0KICAgICAg
dmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwOw0KICAgICAgZWxlbWVudCA9IGVsZW1l
bnQub2Zmc2V0UGFyZW50Ow0KICAgIH0gd2hpbGUgKGVsZW1lbnQpOw0KICAgIHJldHVybiBbdmFs
dWVMLCB2YWx1ZVRdOw0KICB9LA0KDQogIHBvc2l0aW9uZWRPZmZzZXQ6IGZ1bmN0aW9uKGVsZW1l
bnQpIHsNCiAgICB2YXIgdmFsdWVUID0gMCwgdmFsdWVMID0gMDsNCiAgICBkbyB7DQogICAgICB2
YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7DQogICAgICB2YWx1ZUwgKz0gZWxlbWVu
dC5vZmZzZXRMZWZ0IHx8IDA7DQogICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7
DQogICAgICBpZiAoZWxlbWVudCkgew0KICAgICAgICBwID0gRWxlbWVudC5nZXRTdHlsZShlbGVt
ZW50LCAncG9zaXRpb24nKTsNCiAgICAgICAgaWYgKHAgPT0gJ3JlbGF0aXZlJyB8fCBwID09ICdh
YnNvbHV0ZScpIGJyZWFrOw0KICAgICAgfQ0KICAgIH0gd2hpbGUgKGVsZW1lbnQpOw0KICAgIHJl
dHVybiBbdmFsdWVMLCB2YWx1ZVRdOw0KICB9LA0KDQogIG9mZnNldFBhcmVudDogZnVuY3Rpb24o
ZWxlbWVudCkgew0KICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCkgcmV0dXJuIGVsZW1lbnQu
b2Zmc2V0UGFyZW50Ow0KICAgIGlmIChlbGVtZW50ID09IGRvY3VtZW50LmJvZHkpIHJldHVybiBl
bGVtZW50Ow0KDQogICAgd2hpbGUgKChlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlKSAmJiBl
bGVtZW50ICE9IGRvY3VtZW50LmJvZHkpDQogICAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVt
ZW50LCAncG9zaXRpb24nKSAhPSAnc3RhdGljJykNCiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7DQoN
CiAgICByZXR1cm4gZG9jdW1lbnQuYm9keTsNCiAgfSwNCg0KICAvLyBjYWNoZXMgeC95IGNvb3Jk
aW5hdGUgcGFpciB0byB1c2Ugd2l0aCBvdmVybGFwDQogIHdpdGhpbjogZnVuY3Rpb24oZWxlbWVu
dCwgeCwgeSkgew0KICAgIGlmICh0aGlzLmluY2x1ZGVTY3JvbGxPZmZzZXRzKQ0KICAgICAgcmV0
dXJuIHRoaXMud2l0aGluSW5jbHVkaW5nU2Nyb2xsb2Zmc2V0cyhlbGVtZW50LCB4LCB5KTsNCiAg
ICB0aGlzLnhjb21wID0geDsNCiAgICB0aGlzLnljb21wID0geTsNCiAgICB0aGlzLm9mZnNldCA9
IHRoaXMuY3VtdWxhdGl2ZU9mZnNldChlbGVtZW50KTsNCg0KICAgIHJldHVybiAoeSA+PSB0aGlz
Lm9mZnNldFsxXSAmJg0KICAgICAgICAgICAgeSA8ICB0aGlzLm9mZnNldFsxXSArIGVsZW1lbnQu
b2Zmc2V0SGVpZ2h0ICYmDQogICAgICAgICAgICB4ID49IHRoaXMub2Zmc2V0WzBdICYmDQogICAg
ICAgICAgICB4IDwgIHRoaXMub2Zmc2V0WzBdICsgZWxlbWVudC5vZmZzZXRXaWR0aCk7DQogIH0s
DQoNCiAgd2l0aGluSW5jbHVkaW5nU2Nyb2xsb2Zmc2V0czogZnVuY3Rpb24oZWxlbWVudCwgeCwg
eSkgew0KICAgIHZhciBvZmZzZXRjYWNoZSA9IHRoaXMucmVhbE9mZnNldChlbGVtZW50KTsNCg0K
ICAgIHRoaXMueGNvbXAgPSB4ICsgb2Zmc2V0Y2FjaGVbMF0gLSB0aGlzLmRlbHRhWDsNCiAgICB0
aGlzLnljb21wID0geSArIG9mZnNldGNhY2hlWzFdIC0gdGhpcy5kZWx0YVk7DQogICAgdGhpcy5v
ZmZzZXQgPSB0aGlzLmN1bXVsYXRpdmVPZmZzZXQoZWxlbWVudCk7DQoNCiAgICByZXR1cm4gKHRo
aXMueWNvbXAgPj0gdGhpcy5vZmZzZXRbMV0gJiYNCiAgICAgICAgICAgIHRoaXMueWNvbXAgPCAg
dGhpcy5vZmZzZXRbMV0gKyBlbGVtZW50Lm9mZnNldEhlaWdodCAmJg0KICAgICAgICAgICAgdGhp
cy54Y29tcCA+PSB0aGlzLm9mZnNldFswXSAmJg0KICAgICAgICAgICAgdGhpcy54Y29tcCA8ICB0
aGlzLm9mZnNldFswXSArIGVsZW1lbnQub2Zmc2V0V2lkdGgpOw0KICB9LA0KDQogIC8vIHdpdGhp
biBtdXN0IGJlIGNhbGxlZCBkaXJlY3RseSBiZWZvcmUNCiAgb3ZlcmxhcDogZnVuY3Rpb24obW9k
ZSwgZWxlbWVudCkgew0KICAgIGlmICghbW9kZSkgcmV0dXJuIDA7DQogICAgaWYgKG1vZGUgPT0g
J3ZlcnRpY2FsJykNCiAgICAgIHJldHVybiAoKHRoaXMub2Zmc2V0WzFdICsgZWxlbWVudC5vZmZz
ZXRIZWlnaHQpIC0gdGhpcy55Y29tcCkgLw0KICAgICAgICBlbGVtZW50Lm9mZnNldEhlaWdodDsN
CiAgICBpZiAobW9kZSA9PSAnaG9yaXpvbnRhbCcpDQogICAgICByZXR1cm4gKCh0aGlzLm9mZnNl
dFswXSArIGVsZW1lbnQub2Zmc2V0V2lkdGgpIC0gdGhpcy54Y29tcCkgLw0KICAgICAgICBlbGVt
ZW50Lm9mZnNldFdpZHRoOw0KICB9LA0KDQogIGNsb25lOiBmdW5jdGlvbihzb3VyY2UsIHRhcmdl
dCkgew0KICAgIHNvdXJjZSA9ICQoc291cmNlKTsNCiAgICB0YXJnZXQgPSAkKHRhcmdldCk7DQog
ICAgdGFyZ2V0LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsNCiAgICB2YXIgb2Zmc2V0cyA9
IHRoaXMuY3VtdWxhdGl2ZU9mZnNldChzb3VyY2UpOw0KICAgIHRhcmdldC5zdHlsZS50b3AgICAg
PSBvZmZzZXRzWzFdICsgJ3B4JzsNCiAgICB0YXJnZXQuc3R5bGUubGVmdCAgID0gb2Zmc2V0c1sw
XSArICdweCc7DQogICAgdGFyZ2V0LnN0eWxlLndpZHRoICA9IHNvdXJjZS5vZmZzZXRXaWR0aCAr
ICdweCc7DQogICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IHNvdXJjZS5vZmZzZXRIZWlnaHQgKyAn
cHgnOw0KICB9LA0KDQogIHBhZ2U6IGZ1bmN0aW9uKGZvckVsZW1lbnQpIHsNCiAgICB2YXIgdmFs
dWVUID0gMCwgdmFsdWVMID0gMDsNCg0KICAgIHZhciBlbGVtZW50ID0gZm9yRWxlbWVudDsNCiAg
ICBkbyB7DQogICAgICB2YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7DQogICAgICB2
YWx1ZUwgKz0gZWxlbWVudC5vZmZzZXRMZWZ0IHx8IDA7DQoNCiAgICAgIC8vIFNhZmFyaSBmaXgN
CiAgICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudD09ZG9jdW1lbnQuYm9keSkNCiAgICAgICAg
aWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwncG9zaXRpb24nKT09J2Fic29sdXRlJykgYnJl
YWs7DQoNCiAgICB9IHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQpOw0KDQog
ICAgZWxlbWVudCA9IGZvckVsZW1lbnQ7DQogICAgZG8gew0KICAgICAgdmFsdWVUIC09IGVsZW1l
bnQuc2Nyb2xsVG9wICB8fCAwOw0KICAgICAgdmFsdWVMIC09IGVsZW1lbnQuc2Nyb2xsTGVmdCB8
fCAwOw0KICAgIH0gd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUpOw0KDQogICAg
cmV0dXJuIFt2YWx1ZUwsIHZhbHVlVF07DQogIH0sDQoNCiAgY2xvbmU6IGZ1bmN0aW9uKHNvdXJj
ZSwgdGFyZ2V0KSB7DQogICAgdmFyIG9wdGlvbnMgPSBPYmplY3QuZXh0ZW5kKHsNCiAgICAgIHNl
dExlZnQ6ICAgIHRydWUsDQogICAgICBzZXRUb3A6ICAgICB0cnVlLA0KICAgICAgc2V0V2lkdGg6
ICAgdHJ1ZSwNCiAgICAgIHNldEhlaWdodDogIHRydWUsDQogICAgICBvZmZzZXRUb3A6ICAwLA0K
ICAgICAgb2Zmc2V0TGVmdDogMA0KICAgIH0sIGFyZ3VtZW50c1syXSB8fCB7fSkNCg0KICAgIC8v
IGZpbmQgcGFnZSBwb3NpdGlvbiBvZiBzb3VyY2UNCiAgICBzb3VyY2UgPSAkKHNvdXJjZSk7DQog
ICAgdmFyIHAgPSBQb3NpdGlvbi5wYWdlKHNvdXJjZSk7DQoNCiAgICAvLyBmaW5kIGNvb3JkaW5h
dGUgc3lzdGVtIHRvIHVzZQ0KICAgIHRhcmdldCA9ICQodGFyZ2V0KTsNCiAgICB2YXIgZGVsdGEg
PSBbMCwgMF07DQogICAgdmFyIHBhcmVudCA9IG51bGw7DQogICAgLy8gZGVsdGEgWzAsMF0gd2ls
bCBkbyBmaW5lIHdpdGggcG9zaXRpb246IGZpeGVkIGVsZW1lbnRzLA0KICAgIC8vIHBvc2l0aW9u
OmFic29sdXRlIG5lZWRzIG9mZnNldFBhcmVudCBkZWx0YXMNCiAgICBpZiAoRWxlbWVudC5nZXRT
dHlsZSh0YXJnZXQsJ3Bvc2l0aW9uJykgPT0gJ2Fic29sdXRlJykgew0KICAgICAgcGFyZW50ID0g
UG9zaXRpb24ub2Zmc2V0UGFyZW50KHRhcmdldCk7DQogICAgICBkZWx0YSA9IFBvc2l0aW9uLnBh
Z2UocGFyZW50KTsNCiAgICB9DQoNCiAgICAvLyBjb3JyZWN0IGJ5IGJvZHkgb2Zmc2V0cyAoZml4
ZXMgU2FmYXJpKQ0KICAgIGlmIChwYXJlbnQgPT0gZG9jdW1lbnQuYm9keSkgew0KICAgICAgZGVs
dGFbMF0gLT0gZG9jdW1lbnQuYm9keS5vZmZzZXRMZWZ0Ow0KICAgICAgZGVsdGFbMV0gLT0gZG9j
dW1lbnQuYm9keS5vZmZzZXRUb3A7DQogICAgfQ0KDQogICAgLy8gc2V0IHBvc2l0aW9uDQogICAg
aWYob3B0aW9ucy5zZXRMZWZ0KSAgIHRhcmdldC5zdHlsZS5sZWZ0ICA9IChwWzBdIC0gZGVsdGFb
MF0gKyBvcHRpb25zLm9mZnNldExlZnQpICsgJ3B4JzsNCiAgICBpZihvcHRpb25zLnNldFRvcCkg
ICAgdGFyZ2V0LnN0eWxlLnRvcCAgID0gKHBbMV0gLSBkZWx0YVsxXSArIG9wdGlvbnMub2Zmc2V0
VG9wKSArICdweCc7DQogICAgaWYob3B0aW9ucy5zZXRXaWR0aCkgIHRhcmdldC5zdHlsZS53aWR0
aCA9IHNvdXJjZS5vZmZzZXRXaWR0aCArICdweCc7DQogICAgaWYob3B0aW9ucy5zZXRIZWlnaHQp
IHRhcmdldC5zdHlsZS5oZWlnaHQgPSBzb3VyY2Uub2Zmc2V0SGVpZ2h0ICsgJ3B4JzsNCiAgfSwN
Cg0KICBhYnNvbHV0aXplOiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxlbWVudCA9ICQoZWxl
bWVudCk7DQogICAgaWYgKGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPT0gJ2Fic29sdXRlJykgcmV0
dXJuOw0KICAgIFBvc2l0aW9uLnByZXBhcmUoKTsNCg0KICAgIHZhciBvZmZzZXRzID0gUG9zaXRp
b24ucG9zaXRpb25lZE9mZnNldChlbGVtZW50KTsNCiAgICB2YXIgdG9wICAgICA9IG9mZnNldHNb
MV07DQogICAgdmFyIGxlZnQgICAgPSBvZmZzZXRzWzBdOw0KICAgIHZhciB3aWR0aCAgID0gZWxl
bWVudC5jbGllbnRXaWR0aDsNCiAgICB2YXIgaGVpZ2h0ICA9IGVsZW1lbnQuY2xpZW50SGVpZ2h0
Ow0KDQogICAgZWxlbWVudC5fb3JpZ2luYWxMZWZ0ICAgPSBsZWZ0IC0gcGFyc2VGbG9hdChlbGVt
ZW50LnN0eWxlLmxlZnQgIHx8IDApOw0KICAgIGVsZW1lbnQuX29yaWdpbmFsVG9wICAgID0gdG9w
ICAtIHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS50b3AgfHwgMCk7DQogICAgZWxlbWVudC5fb3Jp
Z2luYWxXaWR0aCAgPSBlbGVtZW50LnN0eWxlLndpZHRoOw0KICAgIGVsZW1lbnQuX29yaWdpbmFs
SGVpZ2h0ID0gZWxlbWVudC5zdHlsZS5oZWlnaHQ7DQoNCiAgICBlbGVtZW50LnN0eWxlLnBvc2l0
aW9uID0gJ2Fic29sdXRlJzsNCiAgICBlbGVtZW50LnN0eWxlLnRvcCAgICA9IHRvcCArICdweCc7
Ow0KICAgIGVsZW1lbnQuc3R5bGUubGVmdCAgID0gbGVmdCArICdweCc7Ow0KICAgIGVsZW1lbnQu
c3R5bGUud2lkdGggID0gd2lkdGggKyAncHgnOzsNCiAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9
IGhlaWdodCArICdweCc7Ow0KICB9LA0KDQogIHJlbGF0aXZpemU6IGZ1bmN0aW9uKGVsZW1lbnQp
IHsNCiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsNCiAgICBpZiAoZWxlbWVudC5zdHlsZS5wb3Np
dGlvbiA9PSAncmVsYXRpdmUnKSByZXR1cm47DQogICAgUG9zaXRpb24ucHJlcGFyZSgpOw0KDQog
ICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7DQogICAgdmFyIHRvcCAgPSBw
YXJzZUZsb2F0KGVsZW1lbnQuc3R5bGUudG9wICB8fCAwKSAtIChlbGVtZW50Ll9vcmlnaW5hbFRv
cCB8fCAwKTsNCiAgICB2YXIgbGVmdCA9IHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS5sZWZ0IHx8
IDApIC0gKGVsZW1lbnQuX29yaWdpbmFsTGVmdCB8fCAwKTsNCg0KICAgIGVsZW1lbnQuc3R5bGUu
dG9wICAgID0gdG9wICsgJ3B4JzsNCiAgICBlbGVtZW50LnN0eWxlLmxlZnQgICA9IGxlZnQgKyAn
cHgnOw0KICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gZWxlbWVudC5fb3JpZ2luYWxIZWlnaHQ7
DQogICAgZWxlbWVudC5zdHlsZS53aWR0aCAgPSBlbGVtZW50Ll9vcmlnaW5hbFdpZHRoOw0KICB9
DQp9DQoNCi8vIFNhZmFyaSByZXR1cm5zIG1hcmdpbnMgb24gYm9keSB3aGljaCBpcyBpbmNvcnJl
Y3QgaWYgdGhlIGNoaWxkIGlzIGFic29sdXRlbHkNCi8vIHBvc2l0aW9uZWQuICBGb3IgcGVyZm9y
bWFuY2UgcmVhc29ucywgcmVkZWZpbmUgUG9zaXRpb24uY3VtdWxhdGl2ZU9mZnNldCBmb3INCi8v
IEtIVE1ML1dlYktpdCBvbmx5Lg0KaWYgKC9Lb25xdWVyb3J8U2FmYXJpfEtIVE1MLy50ZXN0KG5h
dmlnYXRvci51c2VyQWdlbnQpKSB7DQogIFBvc2l0aW9uLmN1bXVsYXRpdmVPZmZzZXQgPSBmdW5j
dGlvbihlbGVtZW50KSB7DQogICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7DQogICAgZG8g
ew0KICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wICB8fCAwOw0KICAgICAgdmFsdWVM
ICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwOw0KICAgICAgaWYgKGVsZW1lbnQub2Zmc2V0UGFy
ZW50ID09IGRvY3VtZW50LmJvZHkpDQogICAgICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1l
bnQsICdwb3NpdGlvbicpID09ICdhYnNvbHV0ZScpIGJyZWFrOw0KDQogICAgICBlbGVtZW50ID0g
ZWxlbWVudC5vZmZzZXRQYXJlbnQ7DQogICAgfSB3aGlsZSAoZWxlbWVudCk7DQoNCiAgICByZXR1
cm4gW3ZhbHVlTCwgdmFsdWVUXTsNCiAgfQ0KfQ==
</content>
  </attachment>
  <object>
    <class>
      <name>XWiki.TagClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <tags>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>tags</name>
        <number>1</number>
        <prettyName>Tags</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator>|</separator>
        <separators>|,</separators>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <values/>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </tags>
    </class>
    <name>AdminGuide.Installation</name>
    <number>0</number>
    <className>XWiki.TagClass</className>
    <guid>d524a186-73d9-4938-a2c8-b7fa9a0debfa</guid>
    <property>
      <tags/>
    </property>
  </object>
  <content>{{box cssClass="floatinginfobox" title="**Contents**"}}
{{toc/}}
{{/box}}

XWiki is a Java-based wiki and runs on a Servlet Container such as Tomcat, Jetty, JBoss, WebLogic, WebSphere, etc. It also uses a relational database to store its content. It can run on almost any database (HSQL, MySQL, etc) but XWiki and the database need to be setup correctly.

There are 3 ways of installing XWiki:

* Use the [[Standalone distribution&gt;&gt;AdminGuide.InstallationStandalone]] which already packages a Servlet Container (Jetty) and a database (HSQL). This is the recommended option for first time XWiki users and for users who wish to quickly try out XWiki.
* Use the [[WAR distribution&gt;&gt;AdminGuide.InstallationWAR]] and configure both your container and your database to work with it.
* Use the [[.deb package&gt;&gt;AdminGuide.InstallationViaAPT]] to install the last version of XWiki and the dependencies.

If you're instead upgrading an existing XWiki install check the [[Upgrade instructions page&gt;&gt;AdminGuide.Upgrade]].

Pick one of the trails in the outline on the right to get started.

Once you've finished the installation check the other topics in the [[Admin Guide&gt;&gt;AdminGuide.WebHome]] for configuring and [[securing&gt;&gt;Security]] your wiki.

{{info}}
If you want to make a manual installation or need to migrate an existing XWiki installation, check the [[Release Notes&gt;&gt;xwiki:ReleaseNotes.WebHome]].
{{/info}}

= Prerequisites =

* Java 6 or greater installed.
* A Servlet Container supporting Servlet 2.4.
* A minimum of 300MB of heap memory and 96MB of permGen. Recommended values are above 512MB for the heap and 128MB for the permGen (##-Xmx512m -XX:MaxPermSize=128m##)(((
{{warning}}
Note that storing attachments with the default (in database) storage mechanism is very memory intensive. See the [[administrators guide to attachments&gt;&gt;platform:AdminGuide.Attachments]] for more information about memory cost and the alternative filesystem based attachment store.
{{/warning}}
)))
* Check the [[release notes&gt;&gt;xwiki:ReleaseNotes.WebHome]] for the version you're installing to see what browsers and databases are supported for it. You can also check our [[general support strategy&gt;&gt;dev:Community.SupportStrategy]].

= Tutorials =

Tutorials are step by step procedures to install XWiki for a specific configuration. You can choose to follow one of them or follow the instructions in the sections below.

{{warning}}
Tutorials external to the xwiki.org site have not been validated for correctness by the XWiki dev team and it's also possible that they are out of date.
{{/warning}}

* [[XWiki On Windows (French)&gt;&gt;http://agoncalves.developpez.com/tutoriels/xwiki/creer-un-site-associatif/]]
* [[XWiki On Debian 4 (Etch) - Tomcat - PostgreSQL (or MySQL) (English)&gt;&gt;http://www.howtoforge.com/xwiki-tomcat-mysql-debian-etch]]
* [[XWiki On Debian 4 (Etch) - Tomcat - PostgreSQL (or MySQL) (German)&gt;&gt;http://www.howtoforge.de/howto/xwiki-on-debian-4-etch-tomcat-mysql]]
* [[XWiki On Windows - GlassFish - Oracle (Russian)&gt;&gt;http://etvc.myxwiki.org/xwiki/bin/view/UNA/XWikiInstalation]]
* [[XWiki on OpenSUSE - Tomcat - MySQL (English)&gt;&gt;http://geistreicher-papierkorb.blogspot.com/2011/03/setting-up-xwiki-on-opensuse-with-mysql.html]]

= Installation Methods =

== [[Using a standalone distribution &gt;&gt;AdminGuide.InstallationStandalone]] ==

It provides a built-in XWiki, with a portable database and a lightweight Java container.
A standalone distribution is not recommended in a production environment. If you need to use it in a production basis, you may look at the two other options.

== [[Using .war package (usable for production)&gt;&gt;AdminGuide.InstallationWAR]] ==

It provides a java application package that has to be installed in a Java container (such as Tomcat). This can be used on almost any operating system.

== [[Using .deb package (usable for production)&gt;&gt;AdminGuide.InstallationViaAPT]] ==

It provides a .deb package that can be used on a Debian-based operating system. It can be installed with dpkg or apt; installation is thus automated.

= Troubleshooting =

You can verify some basic settings of your XWiki installation (on Tomcat, MySQL) using the [[Admin Tools application&gt;&gt;extensions:Extension.Admin Tools Application]]. Keep in mind that some of these tools only work in a Linux environment.

== Running multiple instances of XWiki in the same container ==

If you get this error:

{{code}}
com.xpn.xwiki.XWikiException: Error number 3 in 0: Could not initialize main XWiki context
Wrapped Exception: Failed to get cache factory component
...
Caused by:
org.infinispan.jmx.JmxDomainConflictException: Domain already registered org.xwiki.infinispan
{{/code}}

You need to edit ##WEB-INF/cache/infinispan/config.xml## for each instance of XWiki, and change the ##jmxDomain## value (found under the ##globalJmxStatistics## tag) to have a unique name.


== Running XWiki behind proxy-server ==

Extension manager relies on remote repositories for searching and fetching available extensions, so if your XWiki is installed in a network accessing the internet through proxy-server, most likely extensions search will return you nothing and log files will contain ##connection refused## exceptions.

In such cases you should configure XWiki to know your proxy-server.

XWiki uses default Java proxy configuration through Apache httpclient. See the [[Java Networking and Proxies documentation&gt;&gt;http://docs.oracle.com/javase/6/docs/technotes/guides/net/proxies.html]] for more details.
The main idea is to add a set of proxy-related properties to system scope.

E.g. for Tomcat 6 it could be done in the following way: modify ##/&lt;tomcat-home&gt;/bin/catalina.sh## and added proxies to the ##JAVA_OPTS## variable definition:

##JAVA_OPTS="$JAVA_OPTS -Dappserver.home=$CATALINA_HOME -Dappserver.base=$CATALINA_HOME **-Dhttp.proxyHost=proxy.mycompany.com -Dhttp.proxyPort=7777 -Dhttps.proxyHost=proxy.mycompany.com -Dhttps.proxyPort=7777** -Xmx1738m -Xms1738m -XX:MaxPermSize=256m $XWIKI_OPTS"##</content>
</xwikidoc>
